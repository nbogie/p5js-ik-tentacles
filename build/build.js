"use strict";
var Palette = (function () {
    function Palette() {
    }
    Palette.getColors = function () {
        return [
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ];
    };
    Palette.randomColor = function () {
        return random(Palette.getColors());
    };
    return Palette;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
function randomColor() {
    colorMode(HSB, 100);
    return color(random(100), 100, 100);
}
var Segment = (function () {
    function Segment(id, a, b, target, thicknessScale, myHue) {
        this.id = id;
        this.a = a.copy();
        this.b = b.copy();
        this.isFixed = false;
        this.len = a.dist(b);
        colorMode(HSB, 100);
        this.target = target;
        this.myHue = myHue;
        var sat = 50;
        var bright = 50;
        this.myColor = color(this.myHue, sat, random(bright - 10, bright + 10));
        this.edgeColor = color(this.myHue, sat, bright - 20);
        this.thickness = thicknessScale * 50 * random(0.9, 1.1);
        this.targetColor = randomColor();
    }
    Segment.prototype.pos = function () {
        return this.a.copy();
    };
    Segment.prototype.translate = function (offset) {
        this.a.add(offset);
        this.b.add(offset);
    };
    Segment.prototype.drawShadow = function () {
        var off = createVector(20, 10);
        stroke(color(this.myHue, 0, 0, 20));
        noFill();
        strokeWeight(this.thickness);
        line(off.x + this.a.x, off.y + this.a.y, off.x + this.b.x, off.y + this.b.y);
    };
    Segment.prototype.drawSilhoutte = function () {
        noFill();
        stroke(10);
        strokeWeight(this.thickness);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.prototype.drawInner = function () {
        stroke(this.myColor);
        strokeWeight(this.thickness * 0.8);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.drawCrosshairAt = function (pos, colr) {
        strokeWeight(1.8);
        stroke(colr);
        push();
        translate(pos.x, pos.y);
        line(-8, 0, 8, 0);
        line(0, -8, 0, 8);
        pop();
    };
    Segment.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Segment.createRandomAt = function (id, posA, target, thicknessScale, len, myHue) {
        var p1 = posA.copy();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(len));
        return new Segment(id, p1, p2, target, thicknessScale, myHue);
    };
    Segment.prototype.update = function () {
        this.seekTarget(this.target.pos());
    };
    Segment.prototype.seekTarget = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.a);
        this.deltaToTarget = deltaToTarget;
        this.a = targetPos.copy().add(deltaToTarget
            .copy()
            .normalize()
            .mult(-this.len));
        this.b = targetPos.copy();
    };
    return Segment;
}());
var Tentacle = (function () {
    function Tentacle(numSegments, fullLength, baseHueOf100, provideTarget) {
        var _this = this;
        var myHue = random(baseHueOf100 - 5, baseHueOf100 + 5);
        var avgSegmentLength = fullLength / numSegments;
        this.provideTarget = provideTarget;
        var prevPos = createVector(random(width * 0.4, width * 0.6), height * 1.1);
        this.segments = collectDistributedBetween(numSegments, 0, 0.9, function (thickness, ix) {
            var segment = Segment.createRandomAt("Seg" + ix, prevPos, null, 1 - thickness, avgSegmentLength, myHue);
            prevPos = segment.b.copy();
            return segment;
        });
        this.segments[0].isFixed = true;
        var thinnerSegment = null;
        this.segments.reverse().forEach(function (seg) {
            seg.target = thinnerSegment
                ? thinnerSegment
                : { pos: _this.provideTarget };
            thinnerSegment = seg;
        });
        this.segments.reverse();
    }
    Tentacle.prototype.update = function () {
        var originalLockedPos = this.segments[0].a.copy();
        this.segments.reverse();
        for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
            var s = _a[_i];
            s.update();
        }
        this.segments.reverse();
        var moveBackDelta = originalLockedPos
            .copy()
            .sub(this.segments[0].a.copy());
        this.segments.forEach(function (s) { return s.translate(moveBackDelta); });
    };
    Tentacle.prototype.draw = function () {
        if (appOptions.shouldDrawShadows) {
            for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
                var s = _a[_i];
                s.drawShadow();
            }
        }
        for (var _b = 0, _c = this.segments; _b < _c.length; _b++) {
            var s = _c[_b];
            s.drawSilhoutte();
        }
        for (var _d = 0, _e = this.segments; _d < _e.length; _d++) {
            var s = _e[_d];
            s.drawInner();
        }
    };
    return Tentacle;
}());
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function rotateVertexAround(vertex, rotOrigin, angleRad) {
    return vertex
        .copy()
        .sub(rotOrigin)
        .rotate(angleRad)
        .add(rotOrigin);
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        return fn(val);
    });
}
function collectDistributedBetween(numSamples, min, max, fn) {
    var result = [];
    distributeBetween(numSamples, min, max, function (v, ix) { return result.push(fn(v, ix)); });
    return result;
}
function distributeBetween(numSamples, min, max, fn) {
    repeat(numSamples, function (ix) {
        var range = max - min;
        var val = min + (ix * range) / numSamples;
        return fn(val, ix);
    });
}
function averageVectors(vs) {
    if (vs.length < 1) {
        return createVector(0, 0);
    }
    return vs.reduce(function (v1, v2) { return v1.copy().add(v2); }, vs[0]).div(vs.length);
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
p5.disableFriendlyErrors = true;
var defaultAppOptions = {
    shouldDrawShadows: true
};
var appOptions = defaultAppOptions;
function randomAppOptions() {
    return {
        shouldDrawShadows: randomBoolean()
    };
}
var gNumTentacles = 5;
var gTentacles = [];
function collect(n, fn) {
    var res = [];
    for (var i = 0; i < n; i++) {
        res.push(fn(i));
    }
    return res;
}
function mouseHasMoved() {
    return dist(pmouseX, pmouseY, mouseX, mouseY) > 0;
}
function noisyMousePos(phase) {
    var amp = map(sin(frameCount / 20), -1, 1, 10, 40);
    var offsetX = map(noise(3 * phase + frameCount / 20), 0, 1, -amp, amp);
    var offsetY = map(noise(4 * phase + frameCount / 20), 0, 1, -amp, amp);
    return mousePosAsVector().add(createVector(offsetX, offsetY));
}
function makeTargetProvider(phase) {
    var perliner = makePerlinNoisePosFn(phase);
    return function () { return (mouseHasMoved() ? noisyMousePos(phase) : perliner()); };
}
function makePerlinNoisePosFn(phase) {
    return function () {
        return createVector(map(noise(phase + frameCount / 100), 0, 1, width / 2 - height * 0.3, width / 2 + height * 0.3), height * noise(88888 + phase + frameCount / 100));
    };
}
function rebuildTentacles() {
    var baseHue = random(100);
    gTentacles = collect(gNumTentacles, function (ix) {
        var targetProvider = makeTargetProvider(ix * 1000);
        return new Tentacle(200, height, baseHue, targetProvider);
    });
}
function setup() {
    createCanvas(windowWidth, windowHeight);
    rebuildTentacles();
}
function update() {
    gTentacles.forEach(function (t) { return t.update(); });
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    gTentacles.forEach(function (t) { return t.draw(); });
}
function toggleShouldCastShadows() {
    appOptions.shouldDrawShadows = !appOptions.shouldDrawShadows;
}
function mousePressed() {
    rebuildTentacles();
}
function keyPressed() {
    if (key == "s") {
        toggleShouldCastShadows();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFsZXR0ZS50cyIsIlBhcnRpY2xlLnRzIiwiU2VnbWVudC50cyIsIlRlbnRhY2xlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFBQTtJQVlBLENBQUM7SUFYUSxpQkFBUyxHQUFoQjtRQUNFLE9BQU87WUFDTCxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztZQUNwQixLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUM7U0FDcEIsQ0FBQztJQUNKLENBQUM7SUFDTSxtQkFBVyxHQUFsQjtRQUNFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFDSCxjQUFDO0FBQUQsQ0FBQyxBQVpELElBWUM7QUNaRDtJQUdFLGtCQUFZLEdBQWM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUNELHVCQUFJLEdBQUo7UUFDRSxRQUFRLEVBQUUsQ0FBQztRQUNYLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNkLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFFRCw4QkFBVyxHQUFYLFVBQVksR0FBYztRQUN4QixJQUFJLENBQUMs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QUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFJRCxTQUFTLEtBQUs7SUFDWixZQUFZLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3hDLGdCQUFnQixFQUFFLENBQUM7QUFDckIsQ0FBQztBQUVELFNBQVMsTUFBTTtJQUNiLFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQVYsQ0FBVSxDQUFDLENBQUM7QUFDdEMsQ0FBQztBQUtELFNBQVMsSUFBSTtJQUNYLE1BQU0sRUFBRSxDQUFDO0lBQ1QsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2QsUUFBUSxFQUFFLENBQUM7SUFDWCxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFSLENBQVEsQ0FBQyxDQUFDO0FBQ3BDLENBQUM7QUFFRCxTQUFTLHVCQUF1QjtJQUM5QixVQUFVLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUM7QUFDL0QsQ0FBQztBQUVELFNBQVMsWUFBWTtJQUNuQixnQkFBZ0IsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFDRCxTQUFTLFVBQVU7SUFDakIsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFO1FBQ2QsdUJBQXVCLEVBQUUsQ0FBQztLQUMzQjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnA1LmRpc2FibGVGcmllbmRseUVycm9ycyA9IHRydWU7XG5cbmludGVyZmFjZSBBcHBPcHRpb25zIHtcbiAgc2hvdWxkRHJhd1NoYWRvd3M6IGJvb2xlYW47XG59XG5cbmxldCBkZWZhdWx0QXBwT3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgc2hvdWxkRHJhd1NoYWRvd3M6IHRydWVcbn07XG5cbmxldCBhcHBPcHRpb25zOiBBcHBPcHRpb25zID0gZGVmYXVsdEFwcE9wdGlvbnM7XG5cbmZ1bmN0aW9uIHJhbmRvbUFwcE9wdGlvbnMoKTogQXBwT3B0aW9ucyB7XG4gIHJldHVybiB7XG4gICAgc2hvdWxkRHJhd1NoYWRvd3M6IHJhbmRvbUJvb2xlYW4oKVxuICB9O1xufVxuXG5jb25zdCBnTnVtVGVudGFjbGVzID0gNTtcbmxldCBnVGVudGFjbGVzOiBUZW50YWNsZVtdID0gW107XG5mdW5jdGlvbiBjb2xsZWN0PFQ+KG46IG51bWJlciwgZm46IChpeDogbnVtYmVyKSA9PiBUKTogVFtdIHtcbiAgY29uc3QgcmVzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgcmVzLnB1c2goZm4oaSkpO1xuICB9XG4gIHJldHVybiByZXM7XG59XG5mdW5jdGlvbiBtb3VzZUhhc01vdmVkKCkge1xuICByZXR1cm4gZGlzdChwbW91c2VYLCBwbW91c2VZLCBtb3VzZVgsIG1vdXNlWSkgPiAwO1xufVxuZnVuY3Rpb24gbm9pc3lNb3VzZVBvcyhwaGFzZTogbnVtYmVyKSB7XG4gIC8vdW5kdWxhdGluZyBhdHRlbnRpb25cbiAgY29uc3QgYW1wID0gbWFwKHNpbihmcmFtZUNvdW50IC8gMjApLCAtMSwgMSwgMTAsIDQwKTtcblxuICBjb25zdCBvZmZzZXRYID0gbWFwKG5vaXNlKDMgKiBwaGFzZSArIGZyYW1lQ291bnQgLyAyMCksIDAsIDEsIC1hbXAsIGFtcCk7XG4gIGNvbnN0IG9mZnNldFkgPSBtYXAobm9pc2UoNCAqIHBoYXNlICsgZnJhbWVDb3VudCAvIDIwKSwgMCwgMSwgLWFtcCwgYW1wKTtcbiAgcmV0dXJuIG1vdXNlUG9zQXNWZWN0b3IoKS5hZGQoY3JlYXRlVmVjdG9yKG9mZnNldFgsIG9mZnNldFkpKTtcbn1cblxuZnVuY3Rpb24gbWFrZVRhcmdldFByb3ZpZGVyKHBoYXNlOiBudW1iZXIpIHtcbiAgLy8vVE9ETzogbmV2ZXIgcHV0IGEgdGFyZ2V0IGNvbXBsZXRlbHkgb3V0IG9mIHJlYWNoIGFzIHN5c3RlbSBzdHJldGNoZXNcbiAgLy8gb3V0IHVubmF0dXJhbGx5LCBpbm9yZ2FuaWNhbGx5IHN0cmFpZ2h0LlxuICAvLy9JbnN0ZWFkIGlmIHRhcmdldCB3b3VsZCBiZSBvdXQgb2YgcmVhY2ggYnJpbmcgaXQganVzdCB3aXRoaW4gcmVhY2gsIG9uIHNhbWUgbGluZS5cbiAgY29uc3QgcGVybGluZXIgPSBtYWtlUGVybGluTm9pc2VQb3NGbihwaGFzZSk7XG4gIHJldHVybiAoKSA9PiAobW91c2VIYXNNb3ZlZCgpID8gbm9pc3lNb3VzZVBvcyhwaGFzZSkgOiBwZXJsaW5lcigpKTtcbn1cbmZ1bmN0aW9uIG1ha2VQZXJsaW5Ob2lzZVBvc0ZuKHBoYXNlOiBudW1iZXIpIHtcbiAgcmV0dXJuICgpID0+XG4gICAgY3JlYXRlVmVjdG9yKFxuICAgICAgbWFwKFxuICAgICAgICBub2lzZShwaGFzZSArIGZyYW1lQ291bnQgLyAxMDApLFxuICAgICAgICAwLFxuICAgICAgICAxLFxuICAgICAgICB3aWR0aCAvIDIgLSBoZWlnaHQgKiAwLjMsXG4gICAgICAgIHdpZHRoIC8gMiArIGhlaWdodCAqIDAuM1xuICAgICAgKSxcbiAgICAgIGhlaWdodCAqIG5vaXNlKDg4ODg4ICsgcGhhc2UgKyBmcmFtZUNvdW50IC8gMTAwKVxuICAgICk7XG59XG5mdW5jdGlvbiByZWJ1aWxkVGVudGFjbGVzKCkge1xuICBjb25zdCBiYXNlSHVlID0gcmFuZG9tKDEwMCk7XG4gIGdUZW50YWNsZXMgPSBjb2xsZWN0KGdOdW1UZW50YWNsZXMsIGl4ID0+IHtcbiAgICBjb25zdCB0YXJnZXRQcm92aWRlciA9IG1ha2VUYXJnZXRQcm92aWRlcihpeCAqIDEwMDApO1xuICAgIHJldHVybiBuZXcgVGVudGFjbGUoMjAwLCBoZWlnaHQsIGJhc2VIdWUsIHRhcmdldFByb3ZpZGVyKTtcbiAgfSk7XG59XG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFNFVFVQXG4gKi9cbmZ1bmN0aW9uIHNldHVwKCkge1xuICBjcmVhdGVDYW52YXMod2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCk7XG4gIHJlYnVpbGRUZW50YWNsZXMoKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICBnVGVudGFjbGVzLmZvckVhY2godCA9PiB0LnVwZGF0ZSgpKTtcbn1cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBEUkFXXG4gKi9cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gIHVwZGF0ZSgpO1xuICBiYWNrZ3JvdW5kKDApO1xuICBmaWxsKFwiYmxhY2tcIik7XG4gIG5vU3Ryb2tlKCk7XG4gIGdUZW50YWNsZXMuZm9yRWFjaCh0ID0+IHQuZHJhdygpKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlU2hvdWxkQ2FzdFNoYWRvd3MoKSB7XG4gIGFwcE9wdGlvbnMuc2hvdWxkRHJhd1NoYWRvd3MgPSAhYXBwT3B0aW9ucy5zaG91bGREcmF3U2hhZG93cztcbn1cblxuZnVuY3Rpb24gbW91c2VQcmVzc2VkKCkge1xuICByZWJ1aWxkVGVudGFjbGVzKCk7XG59XG5mdW5jdGlvbiBrZXlQcmVzc2VkKCkge1xuICBpZiAoa2V5ID09IFwic1wiKSB7XG4gICAgdG9nZ2xlU2hvdWxkQ2FzdFNoYWRvd3MoKTtcbiAgfVxufVxuIiwiY2xhc3MgUGFsZXR0ZSB7XG4gIHN0YXRpYyBnZXRDb2xvcnMoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIGNvbG9yKDI1MCwgMTA1LCAwKSxcbiAgICAgIGNvbG9yKDEwNSwgMjEwLCAyMzEpLFxuICAgICAgY29sb3IoMTY3LCAyMTksIDIxNiksXG4gICAgICBjb2xvcigyNDMsIDEzNCwgNDgpXG4gICAgXTtcbiAgfVxuICBzdGF0aWMgcmFuZG9tQ29sb3IoKTogcDUuQ29sb3Ige1xuICAgIHJldHVybiByYW5kb20oUGFsZXR0ZS5nZXRDb2xvcnMoKSk7XG4gIH1cbn1cbiIsImNsYXNzIFBhcnRpY2xlIHtcbiAgcG9zOiBwNS5WZWN0b3I7XG5cbiAgY29uc3RydWN0b3IocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcyA9IHBvcy5jb3B5KCk7XG4gIH1cbiAgZHJhdygpIHtcbiAgICBub1N0cm9rZSgpO1xuICAgIGZpbGwoXCJibGFja1wiKTtcbiAgICByZWN0TW9kZShDRU5URVIpO1xuICAgIHNxdWFyZSh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCAzKTtcbiAgICBmaWxsKDAsIDIwKTtcbiAgfVxuXG4gIHNldFBvc2l0aW9uKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MueCA9IHBvcy54O1xuICAgIHRoaXMucG9zLnkgPSBwb3MueTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZShyYW5kb21TY3JlZW5Qb3NpdGlvbigpKTtcbiAgfVxufVxuIiwiaW50ZXJmYWNlIFRhcmdldCB7XG4gIHBvcygpOiBwNS5WZWN0b3I7XG59XG5mdW5jdGlvbiByYW5kb21Db2xvcigpOiBwNS5Db2xvciB7XG4gIGNvbG9yTW9kZShIU0IsIDEwMCk7XG4gIHJldHVybiBjb2xvcihyYW5kb20oMTAwKSwgMTAwLCAxMDApO1xufVxuY2xhc3MgU2VnbWVudCBpbXBsZW1lbnRzIFRhcmdldCB7XG4gIGRlbHRhVG9UYXJnZXQ6IHA1LlZlY3RvcjtcbiAgYTogcDUuVmVjdG9yO1xuICBiOiBwNS5WZWN0b3I7XG4gIGlkOiBzdHJpbmc7XG4gIG15Q29sb3I6IHA1LkNvbG9yO1xuICBlZGdlQ29sb3I6IHA1LkNvbG9yO1xuICB0aGlja25lc3M6IG51bWJlcjtcbiAgbGVuOiBudW1iZXI7XG4gIGlzRml4ZWQ6IGJvb2xlYW47XG4gIHRhcmdldDogVGFyZ2V0O1xuICB0YXJnZXRDb2xvcjogcDUuQ29sb3I7XG4gIG15SHVlOiBudW1iZXI7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgYTogcDUuVmVjdG9yLFxuICAgIGI6IHA1LlZlY3RvcixcbiAgICB0YXJnZXQ6IFRhcmdldCxcbiAgICB0aGlja25lc3NTY2FsZTogbnVtYmVyLFxuICAgIG15SHVlOiBudW1iZXJcbiAgKSB7XG4gICAgdGhpcy5pZCA9IGlkO1xuICAgIHRoaXMuYSA9IGEuY29weSgpO1xuICAgIHRoaXMuYiA9IGIuY29weSgpO1xuICAgIHRoaXMuaXNGaXhlZCA9IGZhbHNlO1xuICAgIHRoaXMubGVuID0gYS5kaXN0KGIpO1xuICAgIGNvbG9yTW9kZShIU0IsIDEwMCk7XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy5teUh1ZSA9IG15SHVlO1xuICAgIGNvbnN0IHNhdCA9IDUwO1xuICAgIGNvbnN0IGJyaWdodCA9IDUwO1xuICAgIHRoaXMubXlDb2xvciA9IGNvbG9yKHRoaXMubXlIdWUsIHNhdCwgcmFuZG9tKGJyaWdodCAtIDEwLCBicmlnaHQgKyAxMCkpO1xuICAgIHRoaXMuZWRnZUNvbG9yID0gY29sb3IodGhpcy5teUh1ZSwgc2F0LCBicmlnaHQgLSAyMCk7XG4gICAgdGhpcy50aGlja25lc3MgPSB0aGlja25lc3NTY2FsZSAqIDUwICogcmFuZG9tKDAuOSwgMS4xKTtcbiAgICB0aGlzLnRhcmdldENvbG9yID0gcmFuZG9tQ29sb3IoKTtcbiAgfVxuICBwb3MoKTogcDUuVmVjdG9yIHtcbiAgICByZXR1cm4gdGhpcy5hLmNvcHkoKTtcbiAgfVxuICB0cmFuc2xhdGUob2Zmc2V0OiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLmEuYWRkKG9mZnNldCk7XG4gICAgdGhpcy5iLmFkZChvZmZzZXQpO1xuICB9XG4gIGRyYXdTaGFkb3coKSB7XG4gICAgY29uc3Qgb2ZmID0gY3JlYXRlVmVjdG9yKDIwLCAxMCk7XG4gICAgc3Ryb2tlKGNvbG9yKHRoaXMubXlIdWUsIDAsIDAsIDIwKSk7XG4gICAgbm9GaWxsKCk7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzKTtcbiAgICBsaW5lKFxuICAgICAgb2ZmLnggKyB0aGlzLmEueCxcbiAgICAgIG9mZi55ICsgdGhpcy5hLnksXG4gICAgICBvZmYueCArIHRoaXMuYi54LFxuICAgICAgb2ZmLnkgKyB0aGlzLmIueVxuICAgICk7XG4gIH1cbiAgZHJhd1NpbGhvdXR0ZSgpIHtcbiAgICBub0ZpbGwoKTtcbiAgICBzdHJva2UoMTApO1xuICAgIHN0cm9rZVdlaWdodCh0aGlzLnRoaWNrbmVzcyk7XG4gICAgbGluZSh0aGlzLmEueCwgdGhpcy5hLnksIHRoaXMuYi54LCB0aGlzLmIueSk7XG4gIH1cbiAgZHJhd0lubmVyKCkge1xuICAgIC8vc3Ryb2tlQ2FwKFNRVUFSRSk7XG4gICAgc3Ryb2tlKHRoaXMubXlDb2xvcik7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzICogMC44KTtcbiAgICBsaW5lKHRoaXMuYS54LCB0aGlzLmEueSwgdGhpcy5iLngsIHRoaXMuYi55KTtcbiAgfVxuICBzdGF0aWMgZHJhd0Nyb3NzaGFpckF0KHBvczogcDUuVmVjdG9yLCBjb2xyOiBwNS5Db2xvcikge1xuICAgIHN0cm9rZVdlaWdodCgxLjgpO1xuICAgIHN0cm9rZShjb2xyKTtcbiAgICBwdXNoKCk7XG4gICAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG4gICAgbGluZSgtOCwgMCwgOCwgMCk7XG4gICAgbGluZSgwLCAtOCwgMCwgOCk7XG4gICAgcG9wKCk7XG4gIH1cbiAgbWlkUG9pbnQoKTogcDUuVmVjdG9yIHtcbiAgICByZXR1cm4gdGhpcy5hLmNvcHkoKS5sZXJwKHRoaXMuYiwgMC41KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb21BdChcbiAgICBpZDogc3RyaW5nLFxuICAgIHBvc0E6IHA1LlZlY3RvcixcbiAgICB0YXJnZXQ6IFRhcmdldCxcbiAgICB0aGlja25lc3NTY2FsZTogbnVtYmVyLFxuICAgIGxlbjogbnVtYmVyLFxuICAgIG15SHVlOiBudW1iZXJcbiAgKSB7XG4gICAgY29uc3QgcDEgPSBwb3NBLmNvcHkoKTtcbiAgICBjb25zdCBwMiA9IHAxLmNvcHkoKS5hZGQocDUuVmVjdG9yLnJhbmRvbTJEKCkubXVsdChsZW4pKTtcbiAgICByZXR1cm4gbmV3IFNlZ21lbnQoaWQsIHAxLCBwMiwgdGFyZ2V0LCB0aGlja25lc3NTY2FsZSwgbXlIdWUpO1xuICB9XG4gIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnNlZWtUYXJnZXQodGhpcy50YXJnZXQucG9zKCkpO1xuICB9XG5cbiAgc2Vla1RhcmdldCh0YXJnZXRQb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICAgIGNvbnN0IGRlbHRhVG9UYXJnZXQgPSB0YXJnZXRQb3MuY29weSgpLnN1Yih0aGlzLmEpO1xuICAgIHRoaXMuZGVsdGFUb1RhcmdldCA9IGRlbHRhVG9UYXJnZXQ7XG4gICAgdGhpcy5hID0gdGFyZ2V0UG9zLmNvcHkoKS5hZGQoXG4gICAgICBkZWx0YVRvVGFyZ2V0XG4gICAgICAgIC5jb3B5KClcbiAgICAgICAgLm5vcm1hbGl6ZSgpXG4gICAgICAgIC5tdWx0KC10aGlzLmxlbilcbiAgICApO1xuICAgIHRoaXMuYiA9IHRhcmdldFBvcy5jb3B5KCk7XG4gIH1cbn1cbiIsImNsYXNzIFRlbnRhY2xlIHtcbiAgc2VnbWVudHM6IFNlZ21lbnRbXTtcbiAgcHJvdmlkZVRhcmdldDogKCkgPT4gcDUuVmVjdG9yO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG51bVNlZ21lbnRzOiBudW1iZXIsXG4gICAgZnVsbExlbmd0aDogbnVtYmVyLFxuICAgIGJhc2VIdWVPZjEwMDogbnVtYmVyLFxuICAgIHByb3ZpZGVUYXJnZXQ6ICgpID0+IHA1LlZlY3RvclxuICApIHtcbiAgICBjb25zdCBteUh1ZSA9IHJhbmRvbShiYXNlSHVlT2YxMDAgLSA1LCBiYXNlSHVlT2YxMDAgKyA1KTtcbiAgICBjb25zdCBhdmdTZWdtZW50TGVuZ3RoID0gZnVsbExlbmd0aCAvIG51bVNlZ21lbnRzO1xuICAgIHRoaXMucHJvdmlkZVRhcmdldCA9IHByb3ZpZGVUYXJnZXQ7XG5cbiAgICBsZXQgcHJldlBvczogcDUuVmVjdG9yID0gY3JlYXRlVmVjdG9yKFxuICAgICAgcmFuZG9tKHdpZHRoICogMC40LCB3aWR0aCAqIDAuNiksXG4gICAgICBoZWlnaHQgKiAxLjFcbiAgICApO1xuICAgIHRoaXMuc2VnbWVudHMgPSBjb2xsZWN0RGlzdHJpYnV0ZWRCZXR3ZWVuKFxuICAgICAgbnVtU2VnbWVudHMsXG4gICAgICAwLFxuICAgICAgMC45LFxuICAgICAgKHRoaWNrbmVzcywgaXgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VnbWVudCA9IFNlZ21lbnQuY3JlYXRlUmFuZG9tQXQoXG4gICAgICAgICAgXCJTZWdcIiArIGl4LFxuICAgICAgICAgIHByZXZQb3MsXG4gICAgICAgICAgbnVsbCxcbiAgICAgICAgICAxIC0gdGhpY2tuZXNzLFxuICAgICAgICAgIGF2Z1NlZ21lbnRMZW5ndGgsXG4gICAgICAgICAgbXlIdWVcbiAgICAgICAgKTtcbiAgICAgICAgcHJldlBvcyA9IHNlZ21lbnQuYi5jb3B5KCk7XG4gICAgICAgIHJldHVybiBzZWdtZW50O1xuICAgICAgfVxuICAgICk7XG4gICAgdGhpcy5zZWdtZW50c1swXS5pc0ZpeGVkID0gdHJ1ZTtcblxuICAgIGxldCB0aGlubmVyU2VnbWVudDogU2VnbWVudCA9IG51bGw7XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCkuZm9yRWFjaChzZWcgPT4ge1xuICAgICAgc2VnLnRhcmdldCA9IHRoaW5uZXJTZWdtZW50XG4gICAgICAgID8gdGhpbm5lclNlZ21lbnRcbiAgICAgICAgOiB7IHBvczogdGhpcy5wcm92aWRlVGFyZ2V0IH07XG4gICAgICB0aGlubmVyU2VnbWVudCA9IHNlZztcbiAgICB9KTtcbiAgICB0aGlzLnNlZ21lbnRzLnJldmVyc2UoKTtcbiAgfVxuICB1cGRhdGUoKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxMb2NrZWRQb3MgPSB0aGlzLnNlZ21lbnRzWzBdLmEuY29weSgpO1xuICAgIHRoaXMuc2VnbWVudHMucmV2ZXJzZSgpO1xuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy51cGRhdGUoKTtcbiAgICB9XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCk7XG4gICAgY29uc3QgbW92ZUJhY2tEZWx0YSA9IG9yaWdpbmFsTG9ja2VkUG9zXG4gICAgICAuY29weSgpXG4gICAgICAuc3ViKHRoaXMuc2VnbWVudHNbMF0uYS5jb3B5KCkpO1xuICAgIHRoaXMuc2VnbWVudHMuZm9yRWFjaChzID0+IHMudHJhbnNsYXRlKG1vdmVCYWNrRGVsdGEpKTtcbiAgfVxuXG4gIGRyYXcoKSB7XG4gICAgaWYgKGFwcE9wdGlvbnMuc2hvdWxkRHJhd1NoYWRvd3MpIHtcbiAgICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgICBzLmRyYXdTaGFkb3coKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGxldCBzIG9mIHRoaXMuc2VnbWVudHMpIHtcbiAgICAgIHMuZHJhd1NpbGhvdXR0ZSgpO1xuICAgIH1cbiAgICBmb3IgKGxldCBzIG9mIHRoaXMuc2VnbWVudHMpIHtcbiAgICAgIHMuZHJhd0lubmVyKCk7XG4gICAgfVxuICB9XG59XG4iLCJmdW5jdGlvbiByYW5kb21TY3JlZW5Qb3NpdGlvbigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHJhbmRvbSh3aWR0aCksIHJhbmRvbShoZWlnaHQpKTtcbn1cblxuZnVuY3Rpb24gY2VudGVyU2NyZWVuUG9zKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbn1cblxuZnVuY3Rpb24gcmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiByb3VuZChyYW5kb20obWluLCBtYXgpKTtcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlVG9WZWMocG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG59XG5mdW5jdGlvbiByb3RhdGVWZXJ0ZXhBcm91bmQoXG4gIHZlcnRleDogcDUuVmVjdG9yLFxuICByb3RPcmlnaW46IHA1LlZlY3RvcixcbiAgYW5nbGVSYWQ6IG51bWJlclxuKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIHZlcnRleFxuICAgIC5jb3B5KClcbiAgICAuc3ViKHJvdE9yaWdpbilcbiAgICAucm90YXRlKGFuZ2xlUmFkKVxuICAgIC5hZGQocm90T3JpZ2luKTtcbn1cblxuLyoqIEZpbmQgdGhlIG1pbmltdW0gb2YgdGhlIGdpdmVuIGxpc3QgYWZ0ZXIgYXBwbHlpbmcgZm4oKSB0byBlYWNoLlxuICogUmV0dXJuIHRoZSBtaW5pbXVtLCBmaXJzdCBtaW5pbXVtLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zLlxuICovXG5mdW5jdGlvbiBtaW5CeTxUPihsaXN0OiBUW10sIGZuOiAoaXRlbTogVCkgPT4gbnVtYmVyKTogVCB7XG4gIGlmIChsaXN0Lmxlbmd0aCA8IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0ID4gcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG5cbi8qKiBSZXBlYXRlZGx5IGNhbGwgdGhlIGdpdmVuIGZ1bmN0aW9uIGZuLCBudW0gdGltZXMsIHRocm93aW5nIGFueSBvdXRwdXQgYXdheS4gKi9cbmZ1bmN0aW9uIHJlcGVhdChudW06IG51bWJlciwgZm46IChpeDogbnVtYmVyKSA9PiB2b2lkKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICBmbihpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBkaXN0cmlidXRlVXBUbyh0b3RhbDogbnVtYmVyLCBtYXg6IG51bWJlciwgZm46ICh2OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgcmVwZWF0KHRvdGFsLCBpeCA9PiB7XG4gICAgY29uc3QgdmFsID0gKGl4ICogbWF4KSAvIHRvdGFsO1xuICAgIHJldHVybiBmbih2YWwpO1xuICB9KTtcbn1cbi8qKiBcbkNvbGxlY3QgYSBzZXQgb2YgdmFsdWVzIGdlbmVyYXRlZCB3aXRoIGZuIGNhbGxlZCB3aXRoIFxuYSByYW5nZSBvZiBudW1TYW1wbGVzIHNhbXBsZXMgZGlzdHJpYnV0ZWQgZXZlbmx5IGZyb20gbWluIHRvIG1heC5cbiovXG5mdW5jdGlvbiBjb2xsZWN0RGlzdHJpYnV0ZWRCZXR3ZWVuPFQ+KFxuICBudW1TYW1wbGVzOiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlcixcbiAgZm46ICh2OiBudW1iZXIsIGl4PzogbnVtYmVyKSA9PiBUXG4pOiBUW10ge1xuICBjb25zdCByZXN1bHQ6IFRbXSA9IFtdO1xuICBkaXN0cmlidXRlQmV0d2VlbihudW1TYW1wbGVzLCBtaW4sIG1heCwgKHYsIGl4KSA9PiByZXN1bHQucHVzaChmbih2LCBpeCkpKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVCZXR3ZWVuKFxuICBudW1TYW1wbGVzOiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlcixcbiAgZm46ICh2OiBudW1iZXIsIGl4PzogbnVtYmVyKSA9PiB2b2lkXG4pIHtcbiAgcmVwZWF0KG51bVNhbXBsZXMsIGl4ID0+IHtcbiAgICBjb25zdCByYW5nZSA9IG1heCAtIG1pbjtcbiAgICBjb25zdCB2YWwgPSBtaW4gKyAoaXggKiByYW5nZSkgLyBudW1TYW1wbGVzO1xuICAgIHJldHVybiBmbih2YWwsIGl4KTtcbiAgfSk7XG59XG5mdW5jdGlvbiBhdmVyYWdlVmVjdG9ycyh2czogcDUuVmVjdG9yW10pOiBwNS5WZWN0b3Ige1xuICBpZiAodnMubGVuZ3RoIDwgMSkge1xuICAgIHJldHVybiBjcmVhdGVWZWN0b3IoMCwgMCk7XG4gIH1cbiAgcmV0dXJuIHZzLnJlZHVjZSgodjEsIHYyKSA9PiB2MS5jb3B5KCkuYWRkKHYyKSwgdnNbMF0pLmRpdih2cy5sZW5ndGgpO1xufVxuXG5mdW5jdGlvbiByYW5kb21Cb29sZWFuKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gTWF0aC5yYW5kb20oKSA+IDAuNTtcbn1cbmZ1bmN0aW9uIG1vdXNlUG9zQXNWZWN0b3IoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcihtb3VzZVgsIG1vdXNlWSk7XG59XG4iXX0=