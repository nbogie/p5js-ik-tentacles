"use strict";
var Palette = (function () {
    function Palette() {
    }
    Palette.getColors = function () {
        return [
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ];
    };
    Palette.randomColor = function () {
        return random(Palette.getColors());
    };
    return Palette;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
function randomColor() {
    colorMode(HSB, 100);
    return color(random(100), 100, 100);
}
var Segment = (function () {
    function Segment(id, a, b, target, thicknessScale, maxThickness, myHue) {
        this.id = id;
        this.a = a.copy();
        this.b = b.copy();
        this.isFixed = false;
        this.len = a.dist(b);
        colorMode(HSB, 100);
        this.target = target;
        this.myHue = myHue;
        var sat = 50;
        var bright = 50;
        this.myColor = color(this.myHue, sat, random(bright - 10, bright + 10));
        this.edgeColor = color(this.myHue, sat, bright - 20);
        this.thickness = thicknessScale * maxThickness * random(0.9, 1.1);
        this.targetColor = randomColor();
    }
    Segment.prototype.pos = function () {
        return this.a.copy();
    };
    Segment.prototype.getAngle = function () {
        return this.b
            .copy()
            .sub(this.a)
            .heading();
    };
    Segment.prototype.translate = function (offset) {
        this.a.add(offset);
        this.b.add(offset);
    };
    Segment.prototype.drawShadow = function () {
        var off = createVector(20, 10);
        stroke(color(this.myHue, 0, 0, 20));
        noFill();
        strokeWeight(this.thickness);
        line(off.x + this.a.x, off.y + this.a.y, off.x + this.b.x, off.y + this.b.y);
    };
    Segment.prototype.drawSilhoutte = function () {
        noFill();
        stroke(10);
        strokeWeight(this.thickness);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.prototype.drawInner = function () {
        stroke(this.myColor);
        strokeWeight(this.thickness * 0.8);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.drawCrosshairAt = function (pos, colr) {
        strokeWeight(1.8);
        stroke(colr);
        push();
        translate(pos.x, pos.y);
        line(-8, 0, 8, 0);
        line(0, -8, 0, 8);
        pop();
    };
    Segment.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Segment.createRandomAt = function (id, posA, target, thicknessScale, maxThickness, len, myHue) {
        var p1 = posA.copy();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(len));
        return new Segment(id, p1, p2, target, thicknessScale, maxThickness, myHue);
    };
    Segment.prototype.update = function () {
        this.seekTarget(this.target.pos());
    };
    Segment.prototype.seekTarget = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.a);
        this.deltaToTarget = deltaToTarget;
        this.a = targetPos.copy().add(deltaToTarget
            .copy()
            .normalize()
            .mult(-this.len));
        this.b = targetPos.copy();
    };
    return Segment;
}());
var Tentacle = (function () {
    function Tentacle(numSegments, fullLength, maxThickness, baseHueOf100, provideTarget) {
        var _this = this;
        var myHue = random(baseHueOf100 - 5, baseHueOf100 + 5);
        var avgSegmentLength = fullLength / numSegments;
        this.provideTarget = provideTarget;
        var prevPos = createVector(random(width * 0.4, width * 0.6), height * 1.1);
        this.segments = collectDistributedBetween(numSegments, 0, 0.9, function (thickness, ix) {
            var segment = Segment.createRandomAt("Seg" + ix, prevPos, null, 1 - thickness, maxThickness, avgSegmentLength, myHue);
            prevPos = segment.b.copy();
            return segment;
        });
        this.segments[0].isFixed = true;
        var thinnerSegment = null;
        this.segments.reverse().forEach(function (seg) {
            seg.target = thinnerSegment ? thinnerSegment : _this.provideTarget;
            thinnerSegment = seg;
        });
        this.segments.reverse();
    }
    Tentacle.prototype.lastSegment = function () {
        return this.segments.length > 0
            ? this.segments[this.segments.length - 1]
            : undefined;
    };
    Tentacle.prototype.firstSegment = function () {
        return this.segments.length > 0 ? this.segments[0] : undefined;
    };
    Tentacle.prototype.setNewTargetProvider = function (givenTargetProvider) {
        this.provideTarget = givenTargetProvider;
        this.lastSegment().target = givenTargetProvider;
    };
    Tentacle.prototype.update = function () {
        var originalLockedPos = this.segments[0].a.copy();
        this.segments.reverse();
        for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
            var s = _a[_i];
            s.update();
        }
        this.segments.reverse();
        var moveBackDelta = originalLockedPos
            .copy()
            .sub(this.segments[0].a.copy());
        this.segments.forEach(function (s) { return s.translate(moveBackDelta); });
    };
    Tentacle.prototype.draw = function () {
        if (appOptions.shouldDrawShadows) {
            for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
                var s = _a[_i];
                s.drawShadow();
            }
        }
        for (var _b = 0, _c = this.segments; _b < _c.length; _b++) {
            var s = _c[_b];
            s.drawSilhoutte();
        }
        for (var _d = 0, _e = this.segments; _d < _e.length; _d++) {
            var s = _e[_d];
            s.drawInner();
        }
    };
    return Tentacle;
}());
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function rotateVertexAround(vertex, rotOrigin, angleRad) {
    return vertex
        .copy()
        .sub(rotOrigin)
        .rotate(angleRad)
        .add(rotOrigin);
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        return fn(val);
    });
}
function collectDistributedBetween(numSamples, min, max, fn) {
    var result = [];
    distributeBetween(numSamples, min, max, function (v, ix) { return result.push(fn(v, ix)); });
    return result;
}
function distributeBetween(numSamples, min, max, fn) {
    repeat(numSamples, function (ix) {
        var range = max - min;
        var val = min + (ix * range) / numSamples;
        return fn(val, ix);
    });
}
function averageVectors(vs) {
    if (vs.length < 1) {
        return createVector(0, 0);
    }
    return vs.reduce(function (v1, v2) { return v1.copy().add(v2); }, vs[0]).div(vs.length);
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function collect(n, fn) {
    var res = [];
    for (var i = 0; i < n; i++) {
        res.push(fn(i));
    }
    return res;
}
p5.disableFriendlyErrors = true;
var defaultAppOptions = {
    shouldDrawShadows: true
};
var appOptions = defaultAppOptions;
var gNumTentacles = 5;
var gTentacles = [];
var gCanvas;
var lovecraftQuotes = [
    "It was not meant that we should voyage far",
    "A mountain walked or stumbled",
    "In his house at R'lyeh, dead Cthulu waits dreaming"
];
function randomAppOptions() {
    return {
        shouldDrawShadows: randomBoolean()
    };
}
function mouseHasMoved() {
    return dist(pmouseX, pmouseY, mouseX, mouseY) > 0;
}
function mousePosPlusNoise(phase) {
    var amp = map(sin(frameCount / 20), -1, 1, 10, 40);
    var offsetX = map(noise(3 * phase + frameCount / 20), 0, 1, -amp, amp);
    var offsetY = map(noise(4 * phase + frameCount / 20), 0, 1, -amp, amp);
    return mousePosAsVector().add(createVector(offsetX, offsetY));
}
function makeTargetProvider(phase) {
    var perlinNoisePosition = makePerlinNoisePosFn(phase);
    return { pos: function () { return mouseHasMoved() ? mousePosPlusNoise(phase) : perlinNoisePosition(); } };
}
function makePerlinNoisePosFn(phase) {
    return function () {
        return createVector(map(noise(phase + frameCount / 100), 0, 1, width / 2 - height * 0.3, width / 2 + height * 0.3), height * noise(88888 + phase + frameCount / 100));
    };
}
function rebuildTentacles() {
    var baseHue = random(100);
    gTentacles = collect(gNumTentacles, function (ix) {
        var targetProvider = makeTargetProvider(ix * 1000);
        return new Tentacle(200, height, random(80, 100), baseHue, targetProvider);
    });
}
function toggleShouldCastShadows() {
    appOptions.shouldDrawShadows = !appOptions.shouldDrawShadows;
}
function mousePressed() {
    rebuildTentacles();
}
function keyPressed() {
    if (key == "s") {
        toggleShouldCastShadows();
    }
    if (key == " ") {
        catchAllTargetWords();
    }
}
function catchAllTargetWords() {
    var elemsToCatch = findTargetWords();
    elemsToCatch.forEach(function (elem, ix) {
        catchTargetElem(elem, gTentacles[ix]);
    });
}
function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}
function setup() {
    gCanvas = createCanvas(windowWidth, windowHeight);
    gCanvas.parent(document.body);
    gCanvas.style("z-index", "-1");
    gCanvas.position(0, 0);
    gCanvas.style("display", "block");
    rebuildTentacles();
}
function update() {
    var targetWords = findTargetWords();
    if (keyIsDown(67)) {
        gTentacles[0].setNewTargetProvider({
            pos: function () { return getPosOfTargetWord(targetWords[0]).pos; }
        });
    }
    gTentacles.forEach(function (t) {
        t.update();
        if (t.heldWord) {
            moveHeldWordTo(t.heldWord, t.lastSegment().b);
            rotateHeldWord(t.heldWord.elem, t.lastSegment().getAngle());
        }
    });
}
function rotateHeldWord(elem, heading) {
    elem.style.transform = "rotate(" + degrees(heading + 90) + "deg)";
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    gTentacles.forEach(function (t) { return t.draw(); });
}
function getPosOfTargetWord(el) {
    var b = el.getBoundingClientRect();
    return {
        left: b.left,
        right: b.right,
        top: b.top,
        bottom: b.bottom,
        width: b.width,
        height: b.height,
        pos: createVector(b.left + b.width / 2, b.top + b.height / 2)
    };
}
function moveHeldWordTo(heldWord, newPos) {
    var elem = heldWord.elem;
    var boundsInfo = heldWord.originalPosAndBounds;
    boundsInfo.width;
    elem.style.left = newPos.x - boundsInfo.width / 2 + "px";
    elem.style.top = newPos.y - boundsInfo.height / 2 + "px";
}
function findTargetWords() {
    return Array.from(document.getElementsByClassName("wordtoeat"));
}
function makeAnimatingTargetProvider(startPos) {
    var isRetreating = true;
    var tgtPos = createVector(random(width * 0.3, width * 0.6), height * 1);
    var animLength = 100;
    var animFrameCount = 0;
    return {
        pos: function () {
            var currPos = startPos.copy().lerp(tgtPos, animFrameCount / animLength);
            if (isRetreating) {
                if (tgtPos.dist(currPos) < 10) {
                    isRetreating = false;
                    animFrameCount = 0;
                    startPos = tgtPos.copy();
                    tgtPos = createVector(random(width * 0.3, width * 0.6), height * 0.3);
                }
            }
            animFrameCount++;
            return currPos;
        }
    };
}
function catchTargetElem(elem, tentacle) {
    var targetElem = elem;
    var clone = targetElem.cloneNode(true);
    targetElem.style.visibility = "hidden";
    document.body.append(clone);
    clone.classList.add("caught");
    gTentacles.forEach(function (t) {
        var targetProvider = makeAnimatingTargetProvider(t.lastSegment().b.copy());
        t.setNewTargetProvider(targetProvider);
    });
    tentacle.heldWord = {
        elem: clone,
        originalPosAndBounds: getPosOfTargetWord(clone)
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFsZXR0ZS50cyIsIlBhcnRpY2xlLnRzIiwiU2VnbWVudC50cyIsIlRlbnRhY2xlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFBQTtJQVlBLENBQUM7SUFYUSxpQkFBUyxHQUFoQjtRQUNFLE9BQU87WUFDTCxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztZQUNwQixLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUM7U0FDcEIsQ0FBQztJQUNKLENBQUM7SUFDTSxtQkFBVyxHQUFsQjtRQUNFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFDSCxjQUFDO0FBQUQsQ0FBQyxBQVpELElBWUM7QUNaRDtJQUdFLGtCQUFZLEdBQWM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUNELHVCQUFJLEdBQUo7UUFDRSxRQUFRLEVBQUUsQ0FBQztRQUNYLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNkLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFFRCw4QkFBVyxHQUFYLFVBQVksR0FBYztRQUN4QixJQUFJLENBQUMs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QUN6QixDQUFDO1FBQ0YsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsR0FBRztRQUNsQixJQUFJLEVBQUUsS0FBSztRQUNYLG9CQUFvQixFQUFFLGtCQUFrQixDQUFDLEtBQUssQ0FBQztLQUNoRCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xucDUuZGlzYWJsZUZyaWVuZGx5RXJyb3JzID0gdHJ1ZTtcblxuLy8gVE9ETzogYWRkIEIgJiBXLCBmaWxtIGdyYWluLCBqaXR0ZXJzLCBibHVycmVkIGNvcm5lcnMuXG5cbmludGVyZmFjZSBBcHBPcHRpb25zIHtcbiAgc2hvdWxkRHJhd1NoYWRvd3M6IGJvb2xlYW47XG59XG5cbmxldCBkZWZhdWx0QXBwT3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgc2hvdWxkRHJhd1NoYWRvd3M6IHRydWVcbn07XG5cbmxldCBhcHBPcHRpb25zOiBBcHBPcHRpb25zID0gZGVmYXVsdEFwcE9wdGlvbnM7XG5cbmNvbnN0IGdOdW1UZW50YWNsZXMgPSA1O1xubGV0IGdUZW50YWNsZXM6IFRlbnRhY2xlW10gPSBbXTtcbmxldCBnQ2FudmFzOyAvLzogUmVuZGVyZXI7ICAvL3R5cGVzY3JpcHQgY2FuJ3QgZmluZCB0aGlzXG5cbmNvbnN0IGxvdmVjcmFmdFF1b3RlcyA9IFtcbiAgXCJJdCB3YXMgbm90IG1lYW50IHRoYXQgd2Ugc2hvdWxkIHZveWFnZSBmYXJcIixcbiAgXCJBIG1vdW50YWluIHdhbGtlZCBvciBzdHVtYmxlZFwiLFxuICBcIkluIGhpcyBob3VzZSBhdCBSJ2x5ZWgsIGRlYWQgQ3RodWx1IHdhaXRzIGRyZWFtaW5nXCJcbl07XG5cbmZ1bmN0aW9uIHJhbmRvbUFwcE9wdGlvbnMoKTogQXBwT3B0aW9ucyB7XG4gIHJldHVybiB7XG4gICAgc2hvdWxkRHJhd1NoYWRvd3M6IHJhbmRvbUJvb2xlYW4oKVxuICB9O1xufVxuXG5mdW5jdGlvbiBtb3VzZUhhc01vdmVkKCkge1xuICByZXR1cm4gZGlzdChwbW91c2VYLCBwbW91c2VZLCBtb3VzZVgsIG1vdXNlWSkgPiAwO1xufVxuXG5mdW5jdGlvbiBtb3VzZVBvc1BsdXNOb2lzZShwaGFzZTogbnVtYmVyKSB7XG4gIC8vdW5kdWxhdGluZyBhdHRlbnRpb25cbiAgY29uc3QgYW1wID0gbWFwKHNpbihmcmFtZUNvdW50IC8gMjApLCAtMSwgMSwgMTAsIDQwKTtcblxuICBjb25zdCBvZmZzZXRYID0gbWFwKG5vaXNlKDMgKiBwaGFzZSArIGZyYW1lQ291bnQgLyAyMCksIDAsIDEsIC1hbXAsIGFtcCk7XG4gIGNvbnN0IG9mZnNldFkgPSBtYXAobm9pc2UoNCAqIHBoYXNlICsgZnJhbWVDb3VudCAvIDIwKSwgMCwgMSwgLWFtcCwgYW1wKTtcbiAgcmV0dXJuIG1vdXNlUG9zQXNWZWN0b3IoKS5hZGQoY3JlYXRlVmVjdG9yKG9mZnNldFgsIG9mZnNldFkpKTtcbn1cblxuZnVuY3Rpb24gbWFrZVRhcmdldFByb3ZpZGVyKHBoYXNlOiBudW1iZXIpOiBUYXJnZXRQcm92aWRlciB7XG4gIC8vL1RPRE86IG5ldmVyIHB1dCBhIHRhcmdldCBjb21wbGV0ZWx5IG91dCBvZiByZWFjaCBhcyBzeXN0ZW0gc3RyZXRjaGVzXG4gIC8vIG91dCB1bm5hdHVyYWxseSwgaW5vcmdhbmljYWxseSBzdHJhaWdodC5cbiAgLy8vSW5zdGVhZCBpZiB0YXJnZXQgd291bGQgYmUgb3V0IG9mIHJlYWNoIGJyaW5nIGl0IGp1c3Qgd2l0aGluIHJlYWNoLCBvbiBzYW1lIGxpbmUuXG4gIGNvbnN0IHBlcmxpbk5vaXNlUG9zaXRpb24gPSBtYWtlUGVybGluTm9pc2VQb3NGbihwaGFzZSk7XG4gIHJldHVybiB7IHBvczogKCkgPT4gbW91c2VIYXNNb3ZlZCgpID8gbW91c2VQb3NQbHVzTm9pc2UocGhhc2UpIDogcGVybGluTm9pc2VQb3NpdGlvbigpIH07XG59XG5cbmZ1bmN0aW9uIG1ha2VQZXJsaW5Ob2lzZVBvc0ZuKHBoYXNlOiBudW1iZXIpIHtcbiAgcmV0dXJuICgpID0+XG4gICAgY3JlYXRlVmVjdG9yKFxuICAgICAgbWFwKFxuICAgICAgICBub2lzZShwaGFzZSArIGZyYW1lQ291bnQgLyAxMDApLFxuICAgICAgICAwLFxuICAgICAgICAxLFxuICAgICAgICB3aWR0aCAvIDIgLSBoZWlnaHQgKiAwLjMsXG4gICAgICAgIHdpZHRoIC8gMiArIGhlaWdodCAqIDAuM1xuICAgICAgKSxcbiAgICAgIGhlaWdodCAqIG5vaXNlKDg4ODg4ICsgcGhhc2UgKyBmcmFtZUNvdW50IC8gMTAwKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIHJlYnVpbGRUZW50YWNsZXMoKSB7XG4gIGNvbnN0IGJhc2VIdWUgPSByYW5kb20oMTAwKTtcbiAgZ1RlbnRhY2xlcyA9IGNvbGxlY3QoZ051bVRlbnRhY2xlcywgaXggPT4ge1xuICAgIGNvbnN0IHRhcmdldFByb3ZpZGVyID0gbWFrZVRhcmdldFByb3ZpZGVyKGl4ICogMTAwMCk7XG4gICAgcmV0dXJuIG5ldyBUZW50YWNsZSgyMDAsIGhlaWdodCwgcmFuZG9tKDgwLCAxMDApLCBiYXNlSHVlLCB0YXJnZXRQcm92aWRlcik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVTaG91bGRDYXN0U2hhZG93cygpIHtcbiAgYXBwT3B0aW9ucy5zaG91bGREcmF3U2hhZG93cyA9ICFhcHBPcHRpb25zLnNob3VsZERyYXdTaGFkb3dzO1xufVxuXG5mdW5jdGlvbiBtb3VzZVByZXNzZWQoKSB7XG4gIHJlYnVpbGRUZW50YWNsZXMoKTtcbn1cblxuZnVuY3Rpb24ga2V5UHJlc3NlZCgpIHtcbiAgaWYgKGtleSA9PSBcInNcIikge1xuICAgIHRvZ2dsZVNob3VsZENhc3RTaGFkb3dzKCk7XG4gIH1cbiAgaWYgKGtleSA9PSBcIiBcIikge1xuICAgIGNhdGNoQWxsVGFyZ2V0V29yZHMoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjYXRjaEFsbFRhcmdldFdvcmRzKCk6IHZvaWQge1xuICBjb25zdCBlbGVtc1RvQ2F0Y2g6IEhUTUxFbGVtZW50W10gPSBmaW5kVGFyZ2V0V29yZHMoKTtcbiAgZWxlbXNUb0NhdGNoLmZvckVhY2goKGVsZW0sIGl4KSA9PiB7XG4gICAgY2F0Y2hUYXJnZXRFbGVtKGVsZW0sIGdUZW50YWNsZXNbaXhdKTtcbiAgfSk7XG59XG5cbi8vaHR0cHM6Ly9naXRodWIuY29tL3Byb2Nlc3NpbmcvcDUuanMvd2lraS9Qb3NpdGlvbmluZy15b3VyLWNhbnZhc1xuZnVuY3Rpb24gd2luZG93UmVzaXplZCgpIHtcbiAgcmVzaXplQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gU0VUVVBcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgZ0NhbnZhcyA9IGNyZWF0ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcbiAgZ0NhbnZhcy5wYXJlbnQoZG9jdW1lbnQuYm9keSk7XG4gIGdDYW52YXMuc3R5bGUoXCJ6LWluZGV4XCIsIFwiLTFcIik7IC8vYmVoaW5kIHRoZSBIVE1MXG4gIGdDYW52YXMucG9zaXRpb24oMCwgMCk7XG4gIGdDYW52YXMuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIik7IC8vIGF2b2lkcyBzY3JvbGxiYXJzXG5cbiAgcmVidWlsZFRlbnRhY2xlcygpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVVBEQVRFXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICBjb25zdCB0YXJnZXRXb3JkczogSFRNTEVsZW1lbnRbXSA9IGZpbmRUYXJnZXRXb3JkcygpO1xuICBpZiAoa2V5SXNEb3duKDY3KSkge1xuICAgIC8vXCJjXCJcbiAgICBnVGVudGFjbGVzWzBdLnNldE5ld1RhcmdldFByb3ZpZGVyKHtcbiAgICAgIHBvczogKCkgPT4gZ2V0UG9zT2ZUYXJnZXRXb3JkKHRhcmdldFdvcmRzWzBdKS5wb3NcbiAgICB9KTtcbiAgfVxuICBnVGVudGFjbGVzLmZvckVhY2godCA9PiB7XG4gICAgdC51cGRhdGUoKTtcbiAgICBpZiAodC5oZWxkV29yZCkge1xuICAgICAgbW92ZUhlbGRXb3JkVG8odC5oZWxkV29yZCwgdC5sYXN0U2VnbWVudCgpLmIpO1xuICAgICAgcm90YXRlSGVsZFdvcmQodC5oZWxkV29yZC5lbGVtLCB0Lmxhc3RTZWdtZW50KCkuZ2V0QW5nbGUoKSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcm90YXRlSGVsZFdvcmQoZWxlbTogSFRNTEVsZW1lbnQsIGhlYWRpbmc6IG51bWJlcikge1xuICBlbGVtLnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlKFwiICsgZGVncmVlcyhoZWFkaW5nICsgOTApICsgXCJkZWcpXCI7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBEUkFXXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gZHJhdygpIHtcbiAgdXBkYXRlKCk7XG4gIGJhY2tncm91bmQoMCk7XG4gIGZpbGwoXCJibGFja1wiKTtcbiAgbm9TdHJva2UoKTtcbiAgZ1RlbnRhY2xlcy5mb3JFYWNoKHQgPT4gdC5kcmF3KCkpO1xufVxuXG5pbnRlcmZhY2UgVGFyZ2V0V29yZFBvcyB7XG4gIGxlZnQ6IG51bWJlcjtcbiAgcmlnaHQ6IG51bWJlcjtcbiAgdG9wOiBudW1iZXI7XG4gIGJvdHRvbTogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgcG9zOiBwNS5WZWN0b3I7XG59XG5cbmZ1bmN0aW9uIGdldFBvc09mVGFyZ2V0V29yZChlbDogRWxlbWVudCk6IFRhcmdldFdvcmRQb3Mge1xuICBjb25zdCBiID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHJldHVybiB7XG4gICAgbGVmdDogYi5sZWZ0LFxuICAgIHJpZ2h0OiBiLnJpZ2h0LFxuICAgIHRvcDogYi50b3AsXG4gICAgYm90dG9tOiBiLmJvdHRvbSxcbiAgICB3aWR0aDogYi53aWR0aCxcbiAgICBoZWlnaHQ6IGIuaGVpZ2h0LFxuICAgIHBvczogY3JlYXRlVmVjdG9yKGIubGVmdCArIGIud2lkdGggLyAyLCBiLnRvcCArIGIuaGVpZ2h0IC8gMilcbiAgfTtcbn1cblxuZnVuY3Rpb24gbW92ZUhlbGRXb3JkVG8oaGVsZFdvcmQ6IEhlbGRET01Xb3JkLCBuZXdQb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICBjb25zdCBlbGVtID0gaGVsZFdvcmQuZWxlbTtcbiAgY29uc3QgYm91bmRzSW5mbyA9IGhlbGRXb3JkLm9yaWdpbmFsUG9zQW5kQm91bmRzO1xuICBib3VuZHNJbmZvLndpZHRoO1xuICBlbGVtLnN0eWxlLmxlZnQgPSBuZXdQb3MueCAtIGJvdW5kc0luZm8ud2lkdGggLyAyICsgXCJweFwiO1xuICBlbGVtLnN0eWxlLnRvcCA9IG5ld1Bvcy55IC0gYm91bmRzSW5mby5oZWlnaHQgLyAyICsgXCJweFwiO1xufVxuXG5mdW5jdGlvbiBmaW5kVGFyZ2V0V29yZHMoKTogSFRNTEVsZW1lbnRbXSB7XG4gIHJldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXG4gICAgXCJ3b3JkdG9lYXRcIlxuICApIGFzIEhUTUxDb2xsZWN0aW9uT2Y8SFRNTEVsZW1lbnQ+KTtcbn1cblxuZnVuY3Rpb24gbWFrZUFuaW1hdGluZ1RhcmdldFByb3ZpZGVyKHN0YXJ0UG9zOiBwNS5WZWN0b3IpIHtcbiAgbGV0IGlzUmV0cmVhdGluZyA9IHRydWU7XG4gIGxldCB0Z3RQb3MgPSBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoICogMC4zLCB3aWR0aCAqIDAuNiksIGhlaWdodCAqIDEpO1xuICBjb25zdCBhbmltTGVuZ3RoID0gMTAwO1xuICBsZXQgYW5pbUZyYW1lQ291bnQgPSAwO1xuXG4gIHJldHVybiB7XG4gICAgcG9zOiAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyUG9zID0gc3RhcnRQb3MuY29weSgpLmxlcnAodGd0UG9zLCBhbmltRnJhbWVDb3VudCAvIGFuaW1MZW5ndGgpO1xuICAgICAgaWYgKGlzUmV0cmVhdGluZykge1xuICAgICAgICBpZiAodGd0UG9zLmRpc3QoY3VyclBvcykgPCAxMCkge1xuICAgICAgICAgIGlzUmV0cmVhdGluZyA9IGZhbHNlO1xuICAgICAgICAgIGFuaW1GcmFtZUNvdW50ID0gMDtcbiAgICAgICAgICBzdGFydFBvcyA9IHRndFBvcy5jb3B5KCk7XG4gICAgICAgICAgdGd0UG9zID0gY3JlYXRlVmVjdG9yKHJhbmRvbSh3aWR0aCAqIDAuMywgd2lkdGggKiAwLjYpLCBoZWlnaHQgKiAwLjMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhbmltRnJhbWVDb3VudCsrO1xuICAgICAgcmV0dXJuIGN1cnJQb3M7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBjYXRjaFRhcmdldEVsZW0oZWxlbTogSFRNTEVsZW1lbnQsIHRlbnRhY2xlOiBUZW50YWNsZSk6IHZvaWQge1xuICBjb25zdCB0YXJnZXRFbGVtOiBIVE1MRWxlbWVudCA9IGVsZW07XG4gIGNvbnN0IGNsb25lID0gdGFyZ2V0RWxlbS5jbG9uZU5vZGUodHJ1ZSkgYXMgSFRNTEVsZW1lbnQ7IC8vb25seSB0aGlzIGhhcyBzdHlsZVxuICB0YXJnZXRFbGVtLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kKGNsb25lKTtcbiAgY2xvbmUuY2xhc3NMaXN0LmFkZChcImNhdWdodFwiKTsgLy90aGlzIGluY2x1ZGVzIGFic29sdXRlIHBvc2l0aW9uaW5nXG5cbiAgZ1RlbnRhY2xlcy5mb3JFYWNoKHQgPT4ge1xuICAgIGNvbnN0IHRhcmdldFByb3ZpZGVyID0gbWFrZUFuaW1hdGluZ1RhcmdldFByb3ZpZGVyKFxuICAgICAgdC5sYXN0U2VnbWVudCgpLmIuY29weSgpXG4gICAgKTtcbiAgICB0LnNldE5ld1RhcmdldFByb3ZpZGVyKHRhcmdldFByb3ZpZGVyKTtcbiAgfSk7XG5cbiAgdGVudGFjbGUuaGVsZFdvcmQgPSB7XG4gICAgZWxlbTogY2xvbmUsXG4gICAgb3JpZ2luYWxQb3NBbmRCb3VuZHM6IGdldFBvc09mVGFyZ2V0V29yZChjbG9uZSlcbiAgfTtcbn1cbiIsImNsYXNzIFBhbGV0dGUge1xuICBzdGF0aWMgZ2V0Q29sb3JzKCkge1xuICAgIHJldHVybiBbXG4gICAgICBjb2xvcigyNTAsIDEwNSwgMCksXG4gICAgICBjb2xvcigxMDUsIDIxMCwgMjMxKSxcbiAgICAgIGNvbG9yKDE2NywgMjE5LCAyMTYpLFxuICAgICAgY29sb3IoMjQzLCAxMzQsIDQ4KVxuICAgIF07XG4gIH1cbiAgc3RhdGljIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgICByZXR1cm4gcmFuZG9tKFBhbGV0dGUuZ2V0Q29sb3JzKCkpO1xuICB9XG59XG4iLCJjbGFzcyBQYXJ0aWNsZSB7XG4gIHBvczogcDUuVmVjdG9yO1xuXG4gIGNvbnN0cnVjdG9yKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MgPSBwb3MuY29weSgpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgbm9TdHJva2UoKTtcbiAgICBmaWxsKFwiYmxhY2tcIik7XG4gICAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgICBzcXVhcmUodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMyk7XG4gICAgZmlsbCgwLCAyMCk7XG4gIH1cblxuICBzZXRQb3NpdGlvbihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMucG9zLnggPSBwb3MueDtcbiAgICB0aGlzLnBvcy55ID0gcG9zLnk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUocmFuZG9tU2NyZWVuUG9zaXRpb24oKSk7XG4gIH1cbn1cbiIsImZ1bmN0aW9uIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgY29sb3JNb2RlKEhTQiwgMTAwKTtcbiAgcmV0dXJuIGNvbG9yKHJhbmRvbSgxMDApLCAxMDAsIDEwMCk7XG59XG5jbGFzcyBTZWdtZW50IGltcGxlbWVudHMgVGFyZ2V0UHJvdmlkZXIge1xuICBkZWx0YVRvVGFyZ2V0OiBwNS5WZWN0b3I7XG4gIGE6IHA1LlZlY3RvcjtcbiAgYjogcDUuVmVjdG9yO1xuICBpZDogc3RyaW5nO1xuICBteUNvbG9yOiBwNS5Db2xvcjtcbiAgZWRnZUNvbG9yOiBwNS5Db2xvcjtcbiAgdGhpY2tuZXNzOiBudW1iZXI7XG4gIGxlbjogbnVtYmVyO1xuICBpc0ZpeGVkOiBib29sZWFuO1xuICB0YXJnZXQ6IFRhcmdldFByb3ZpZGVyO1xuICB0YXJnZXRDb2xvcjogcDUuQ29sb3I7XG4gIG15SHVlOiBudW1iZXI7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgYTogcDUuVmVjdG9yLFxuICAgIGI6IHA1LlZlY3RvcixcbiAgICB0YXJnZXQ6IFRhcmdldFByb3ZpZGVyLFxuICAgIHRoaWNrbmVzc1NjYWxlOiBudW1iZXIsXG4gICAgbWF4VGhpY2tuZXNzOiBudW1iZXIsXG4gICAgbXlIdWU6IG51bWJlclxuICApIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5hID0gYS5jb3B5KCk7XG4gICAgdGhpcy5iID0gYi5jb3B5KCk7XG4gICAgdGhpcy5pc0ZpeGVkID0gZmFsc2U7XG4gICAgdGhpcy5sZW4gPSBhLmRpc3QoYik7XG4gICAgY29sb3JNb2RlKEhTQiwgMTAwKTtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLm15SHVlID0gbXlIdWU7XG4gICAgY29uc3Qgc2F0ID0gNTA7XG4gICAgY29uc3QgYnJpZ2h0ID0gNTA7XG4gICAgdGhpcy5teUNvbG9yID0gY29sb3IodGhpcy5teUh1ZSwgc2F0LCByYW5kb20oYnJpZ2h0IC0gMTAsIGJyaWdodCArIDEwKSk7XG4gICAgdGhpcy5lZGdlQ29sb3IgPSBjb2xvcih0aGlzLm15SHVlLCBzYXQsIGJyaWdodCAtIDIwKTtcbiAgICB0aGlzLnRoaWNrbmVzcyA9IHRoaWNrbmVzc1NjYWxlICogbWF4VGhpY2tuZXNzICogcmFuZG9tKDAuOSwgMS4xKTtcbiAgICB0aGlzLnRhcmdldENvbG9yID0gcmFuZG9tQ29sb3IoKTtcbiAgfVxuICBwb3MoKTogcDUuVmVjdG9yIHtcbiAgICByZXR1cm4gdGhpcy5hLmNvcHkoKTtcbiAgfVxuICBnZXRBbmdsZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmJcbiAgICAgIC5jb3B5KClcbiAgICAgIC5zdWIodGhpcy5hKVxuICAgICAgLmhlYWRpbmcoKTtcbiAgfVxuICB0cmFuc2xhdGUob2Zmc2V0OiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLmEuYWRkKG9mZnNldCk7XG4gICAgdGhpcy5iLmFkZChvZmZzZXQpO1xuICB9XG4gIGRyYXdTaGFkb3coKSB7XG4gICAgY29uc3Qgb2ZmID0gY3JlYXRlVmVjdG9yKDIwLCAxMCk7XG4gICAgc3Ryb2tlKGNvbG9yKHRoaXMubXlIdWUsIDAsIDAsIDIwKSk7XG4gICAgbm9GaWxsKCk7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzKTtcbiAgICBsaW5lKFxuICAgICAgb2ZmLnggKyB0aGlzLmEueCxcbiAgICAgIG9mZi55ICsgdGhpcy5hLnksXG4gICAgICBvZmYueCArIHRoaXMuYi54LFxuICAgICAgb2ZmLnkgKyB0aGlzLmIueVxuICAgICk7XG4gIH1cbiAgZHJhd1NpbGhvdXR0ZSgpIHtcbiAgICBub0ZpbGwoKTtcbiAgICBzdHJva2UoMTApO1xuICAgIHN0cm9rZVdlaWdodCh0aGlzLnRoaWNrbmVzcyk7XG4gICAgbGluZSh0aGlzLmEueCwgdGhpcy5hLnksIHRoaXMuYi54LCB0aGlzLmIueSk7XG4gIH1cbiAgZHJhd0lubmVyKCkge1xuICAgIC8vc3Ryb2tlQ2FwKFNRVUFSRSk7XG4gICAgc3Ryb2tlKHRoaXMubXlDb2xvcik7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzICogMC44KTtcbiAgICBsaW5lKHRoaXMuYS54LCB0aGlzLmEueSwgdGhpcy5iLngsIHRoaXMuYi55KTtcbiAgfVxuICBzdGF0aWMgZHJhd0Nyb3NzaGFpckF0KHBvczogcDUuVmVjdG9yLCBjb2xyOiBwNS5Db2xvcikge1xuICAgIHN0cm9rZVdlaWdodCgxLjgpO1xuICAgIHN0cm9rZShjb2xyKTtcbiAgICBwdXNoKCk7XG4gICAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG4gICAgbGluZSgtOCwgMCwgOCwgMCk7XG4gICAgbGluZSgwLCAtOCwgMCwgOCk7XG4gICAgcG9wKCk7XG4gIH1cbiAgbWlkUG9pbnQoKTogcDUuVmVjdG9yIHtcbiAgICByZXR1cm4gdGhpcy5hLmNvcHkoKS5sZXJwKHRoaXMuYiwgMC41KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb21BdChcbiAgICBpZDogc3RyaW5nLFxuICAgIHBvc0E6IHA1LlZlY3RvcixcbiAgICB0YXJnZXQ6IFRhcmdldFByb3ZpZGVyLFxuICAgIHRoaWNrbmVzc1NjYWxlOiBudW1iZXIsXG4gICAgbWF4VGhpY2tuZXNzOiBudW1iZXIsXG4gICAgbGVuOiBudW1iZXIsXG4gICAgbXlIdWU6IG51bWJlclxuICApIHtcbiAgICBjb25zdCBwMSA9IHBvc0EuY29weSgpO1xuICAgIGNvbnN0IHAyID0gcDEuY29weSgpLmFkZChwNS5WZWN0b3IucmFuZG9tMkQoKS5tdWx0KGxlbikpO1xuICAgIHJldHVybiBuZXcgU2VnbWVudChpZCwgcDEsIHAyLCB0YXJnZXQsIHRoaWNrbmVzc1NjYWxlLCBtYXhUaGlja25lc3MsIG15SHVlKTtcbiAgfVxuICB1cGRhdGUoKTogdm9pZCB7XG4gICAgdGhpcy5zZWVrVGFyZ2V0KHRoaXMudGFyZ2V0LnBvcygpKTtcbiAgfVxuXG4gIHNlZWtUYXJnZXQodGFyZ2V0UG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBkZWx0YVRvVGFyZ2V0ID0gdGFyZ2V0UG9zLmNvcHkoKS5zdWIodGhpcy5hKTtcbiAgICB0aGlzLmRlbHRhVG9UYXJnZXQgPSBkZWx0YVRvVGFyZ2V0O1xuICAgIHRoaXMuYSA9IHRhcmdldFBvcy5jb3B5KCkuYWRkKFxuICAgICAgZGVsdGFUb1RhcmdldFxuICAgICAgICAuY29weSgpXG4gICAgICAgIC5ub3JtYWxpemUoKVxuICAgICAgICAubXVsdCgtdGhpcy5sZW4pXG4gICAgKTtcbiAgICB0aGlzLmIgPSB0YXJnZXRQb3MuY29weSgpO1xuICB9XG59XG4iLCJpbnRlcmZhY2UgVGFyZ2V0UHJvdmlkZXIge1xuICBwb3MoKTogcDUuVmVjdG9yO1xufVxuXG5pbnRlcmZhY2UgSGVsZERPTVdvcmQge1xuICBlbGVtOiBIVE1MRWxlbWVudDtcbiAgb3JpZ2luYWxQb3NBbmRCb3VuZHM6IFRhcmdldFdvcmRQb3M7XG59XG5jbGFzcyBUZW50YWNsZSB7XG4gIHNlZ21lbnRzOiBTZWdtZW50W107XG4gIHByb3ZpZGVUYXJnZXQ6IFRhcmdldFByb3ZpZGVyO1xuXG4gIGhlbGRXb3JkPzogSGVsZERPTVdvcmQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbnVtU2VnbWVudHM6IG51bWJlcixcbiAgICBmdWxsTGVuZ3RoOiBudW1iZXIsXG4gICAgbWF4VGhpY2tuZXNzOiBudW1iZXIsXG4gICAgYmFzZUh1ZU9mMTAwOiBudW1iZXIsXG4gICAgcHJvdmlkZVRhcmdldDogVGFyZ2V0UHJvdmlkZXJcbiAgKSB7XG4gICAgY29uc3QgbXlIdWUgPSByYW5kb20oYmFzZUh1ZU9mMTAwIC0gNSwgYmFzZUh1ZU9mMTAwICsgNSk7XG4gICAgY29uc3QgYXZnU2VnbWVudExlbmd0aCA9IGZ1bGxMZW5ndGggLyBudW1TZWdtZW50cztcbiAgICB0aGlzLnByb3ZpZGVUYXJnZXQgPSBwcm92aWRlVGFyZ2V0O1xuXG4gICAgbGV0IHByZXZQb3M6IHA1LlZlY3RvciA9IGNyZWF0ZVZlY3RvcihcbiAgICAgIHJhbmRvbSh3aWR0aCAqIDAuNCwgd2lkdGggKiAwLjYpLFxuICAgICAgaGVpZ2h0ICogMS4xXG4gICAgKTtcbiAgICB0aGlzLnNlZ21lbnRzID0gY29sbGVjdERpc3RyaWJ1dGVkQmV0d2VlbihcbiAgICAgIG51bVNlZ21lbnRzLFxuICAgICAgMCxcbiAgICAgIDAuOSxcbiAgICAgICh0aGlja25lc3MsIGl4KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlZ21lbnQgPSBTZWdtZW50LmNyZWF0ZVJhbmRvbUF0KFxuICAgICAgICAgIFwiU2VnXCIgKyBpeCxcbiAgICAgICAgICBwcmV2UG9zLFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICAgMSAtIHRoaWNrbmVzcyxcbiAgICAgICAgICBtYXhUaGlja25lc3MsXG4gICAgICAgICAgYXZnU2VnbWVudExlbmd0aCxcbiAgICAgICAgICBteUh1ZVxuICAgICAgICApO1xuICAgICAgICBwcmV2UG9zID0gc2VnbWVudC5iLmNvcHkoKTtcbiAgICAgICAgcmV0dXJuIHNlZ21lbnQ7XG4gICAgICB9XG4gICAgKTtcbiAgICB0aGlzLnNlZ21lbnRzWzBdLmlzRml4ZWQgPSB0cnVlO1xuXG4gICAgbGV0IHRoaW5uZXJTZWdtZW50OiBTZWdtZW50ID0gbnVsbDtcbiAgICB0aGlzLnNlZ21lbnRzLnJldmVyc2UoKS5mb3JFYWNoKHNlZyA9PiB7XG4gICAgICBzZWcudGFyZ2V0ID0gdGhpbm5lclNlZ21lbnQgPyB0aGlubmVyU2VnbWVudCA6IHRoaXMucHJvdmlkZVRhcmdldDtcbiAgICAgIHRoaW5uZXJTZWdtZW50ID0gc2VnO1xuICAgIH0pO1xuICAgIHRoaXMuc2VnbWVudHMucmV2ZXJzZSgpO1xuICB9XG4gIGxhc3RTZWdtZW50KCk6IFNlZ21lbnQge1xuICAgIHJldHVybiB0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDBcbiAgICAgID8gdGhpcy5zZWdtZW50c1t0aGlzLnNlZ21lbnRzLmxlbmd0aCAtIDFdXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgfVxuICBmaXJzdFNlZ21lbnQoKTogU2VnbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuc2VnbWVudHMubGVuZ3RoID4gMCA/IHRoaXMuc2VnbWVudHNbMF0gOiB1bmRlZmluZWQ7XG4gIH1cbiAgc2V0TmV3VGFyZ2V0UHJvdmlkZXIoZ2l2ZW5UYXJnZXRQcm92aWRlcjogVGFyZ2V0UHJvdmlkZXIpOiB2b2lkIHtcbiAgICB0aGlzLnByb3ZpZGVUYXJnZXQgPSBnaXZlblRhcmdldFByb3ZpZGVyO1xuICAgIHRoaXMubGFzdFNlZ21lbnQoKS50YXJnZXQgPSBnaXZlblRhcmdldFByb3ZpZGVyO1xuICB9XG4gIHVwZGF0ZSgpIHtcbiAgICBjb25zdCBvcmlnaW5hbExvY2tlZFBvcyA9IHRoaXMuc2VnbWVudHNbMF0uYS5jb3B5KCk7XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCk7XG4gICAgZm9yIChsZXQgcyBvZiB0aGlzLnNlZ21lbnRzKSB7XG4gICAgICBzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICB0aGlzLnNlZ21lbnRzLnJldmVyc2UoKTtcbiAgICBjb25zdCBtb3ZlQmFja0RlbHRhID0gb3JpZ2luYWxMb2NrZWRQb3NcbiAgICAgIC5jb3B5KClcbiAgICAgIC5zdWIodGhpcy5zZWdtZW50c1swXS5hLmNvcHkoKSk7XG4gICAgdGhpcy5zZWdtZW50cy5mb3JFYWNoKHMgPT4gcy50cmFuc2xhdGUobW92ZUJhY2tEZWx0YSkpO1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICBpZiAoYXBwT3B0aW9ucy5zaG91bGREcmF3U2hhZG93cykge1xuICAgICAgZm9yIChsZXQgcyBvZiB0aGlzLnNlZ21lbnRzKSB7XG4gICAgICAgIHMuZHJhd1NoYWRvdygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3U2lsaG91dHRlKCk7XG4gICAgfVxuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3SW5uZXIoKTtcbiAgICB9XG4gIH1cbn1cbiIsImZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiBjZW50ZXJTY3JlZW5Qb3MoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRleEFyb3VuZChcbiAgdmVydGV4OiBwNS5WZWN0b3IsXG4gIHJvdE9yaWdpbjogcDUuVmVjdG9yLFxuICBhbmdsZVJhZDogbnVtYmVyXG4pOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gdmVydGV4XG4gICAgLmNvcHkoKVxuICAgIC5zdWIocm90T3JpZ2luKVxuICAgIC5yb3RhdGUoYW5nbGVSYWQpXG4gICAgLmFkZChyb3RPcmlnaW4pO1xufVxuXG4vKiogRmluZCB0aGUgbWluaW11bSBvZiB0aGUgZ2l2ZW4gbGlzdCBhZnRlciBhcHBseWluZyBmbigpIHRvIGVhY2guXG4gKiBSZXR1cm4gdGhlIG1pbmltdW0sIGZpcnN0IG1pbmltdW0sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbm8gaXRlbXMuXG4gKi9cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgbGV0IHJlY29yZEl0ZW0gPSBsaXN0WzBdO1xuICBsZXQgcmVjb3JkV2VpZ2h0ID0gZm4obGlzdFswXSk7XG4gIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xuICAgIGNvbnN0IHdlaWdodCA9IGZuKGl0ZW0pO1xuICAgIGlmICh3ZWlnaHQgPiByZWNvcmRXZWlnaHQpIHtcbiAgICAgIHJlY29yZFdlaWdodCA9IHdlaWdodDtcbiAgICAgIHJlY29yZEl0ZW0gPSBpdGVtO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVjb3JkSXRlbTtcbn1cblxuLyoqIFJlcGVhdGVkbHkgY2FsbCB0aGUgZ2l2ZW4gZnVuY3Rpb24gZm4sIG51bSB0aW1lcywgdGhyb3dpbmcgYW55IG91dHB1dCBhd2F5LiAqL1xuZnVuY3Rpb24gcmVwZWF0KG51bTogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgIGZuKGkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVVcFRvKHRvdGFsOiBudW1iZXIsIG1heDogbnVtYmVyLCBmbjogKHY6IG51bWJlcikgPT4gdm9pZCkge1xuICByZXBlYXQodG90YWwsIGl4ID0+IHtcbiAgICBjb25zdCB2YWwgPSAoaXggKiBtYXgpIC8gdG90YWw7XG4gICAgcmV0dXJuIGZuKHZhbCk7XG4gIH0pO1xufVxuLyoqIFxuQ29sbGVjdCBhIHNldCBvZiB2YWx1ZXMgZ2VuZXJhdGVkIHdpdGggZm4gY2FsbGVkIHdpdGggXG5hIHJhbmdlIG9mIG51bVNhbXBsZXMgc2FtcGxlcyBkaXN0cmlidXRlZCBldmVubHkgZnJvbSBtaW4gdG8gbWF4LlxuKi9cbmZ1bmN0aW9uIGNvbGxlY3REaXN0cmlidXRlZEJldHdlZW48VD4oXG4gIG51bVNhbXBsZXM6IG51bWJlcixcbiAgbWluOiBudW1iZXIsXG4gIG1heDogbnVtYmVyLFxuICBmbjogKHY6IG51bWJlciwgaXg/OiBudW1iZXIpID0+IFRcbik6IFRbXSB7XG4gIGNvbnN0IHJlc3VsdDogVFtdID0gW107XG4gIGRpc3RyaWJ1dGVCZXR3ZWVuKG51bVNhbXBsZXMsIG1pbiwgbWF4LCAodiwgaXgpID0+IHJlc3VsdC5wdXNoKGZuKHYsIGl4KSkpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gZGlzdHJpYnV0ZUJldHdlZW4oXG4gIG51bVNhbXBsZXM6IG51bWJlcixcbiAgbWluOiBudW1iZXIsXG4gIG1heDogbnVtYmVyLFxuICBmbjogKHY6IG51bWJlciwgaXg/OiBudW1iZXIpID0+IHZvaWRcbikge1xuICByZXBlYXQobnVtU2FtcGxlcywgaXggPT4ge1xuICAgIGNvbnN0IHJhbmdlID0gbWF4IC0gbWluO1xuICAgIGNvbnN0IHZhbCA9IG1pbiArIChpeCAqIHJhbmdlKSAvIG51bVNhbXBsZXM7XG4gICAgcmV0dXJuIGZuKHZhbCwgaXgpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGF2ZXJhZ2VWZWN0b3JzKHZzOiBwNS5WZWN0b3JbXSk6IHA1LlZlY3RvciB7XG4gIGlmICh2cy5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIGNyZWF0ZVZlY3RvcigwLCAwKTtcbiAgfVxuICByZXR1cm4gdnMucmVkdWNlKCh2MSwgdjIpID0+IHYxLmNvcHkoKS5hZGQodjIpLCB2c1swXSkuZGl2KHZzLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUJvb2xlYW4oKTogYm9vbGVhbiB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpID4gMC41O1xufVxuZnVuY3Rpb24gbW91c2VQb3NBc1ZlY3RvcigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKG1vdXNlWCwgbW91c2VZKTtcbn1cbmZ1bmN0aW9uIGNvbGxlY3Q8VD4objogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IFQpOiBUW10ge1xuICBjb25zdCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICByZXMucHVzaChmbihpKSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cbiJdfQ==