"use strict";
var Palette = (function () {
    function Palette() {
    }
    Palette.getColors = function () {
        return [
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ];
    };
    Palette.randomColor = function () {
        return random(Palette.getColors());
    };
    return Palette;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
function randomColor() {
    colorMode(HSB, 100);
    return color(random(100), 100, 100);
}
var Segment = (function () {
    function Segment(id, a, b, target, thicknessScale, maxThickness, myHue) {
        this.id = id;
        this.a = a.copy();
        this.b = b.copy();
        this.isFixed = false;
        this.len = a.dist(b);
        colorMode(HSB, 100);
        this.target = target;
        this.myHue = myHue;
        var sat = 50;
        var bright = 50;
        this.myColor = color(this.myHue, sat, random(bright - 10, bright + 10));
        this.edgeColor = color(this.myHue, sat, bright - 20);
        this.thickness = thicknessScale * maxThickness * random(0.9, 1.1);
        this.targetColor = randomColor();
    }
    Segment.prototype.pos = function () {
        return this.a.copy();
    };
    Segment.prototype.translate = function (offset) {
        this.a.add(offset);
        this.b.add(offset);
    };
    Segment.prototype.drawShadow = function () {
        var off = createVector(20, 10);
        stroke(color(this.myHue, 0, 0, 20));
        noFill();
        strokeWeight(this.thickness);
        line(off.x + this.a.x, off.y + this.a.y, off.x + this.b.x, off.y + this.b.y);
    };
    Segment.prototype.drawSilhoutte = function () {
        noFill();
        stroke(10);
        strokeWeight(this.thickness);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.prototype.drawInner = function () {
        stroke(this.myColor);
        strokeWeight(this.thickness * 0.8);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.drawCrosshairAt = function (pos, colr) {
        strokeWeight(1.8);
        stroke(colr);
        push();
        translate(pos.x, pos.y);
        line(-8, 0, 8, 0);
        line(0, -8, 0, 8);
        pop();
    };
    Segment.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Segment.createRandomAt = function (id, posA, target, thicknessScale, maxThickness, len, myHue) {
        var p1 = posA.copy();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(len));
        return new Segment(id, p1, p2, target, thicknessScale, maxThickness, myHue);
    };
    Segment.prototype.update = function () {
        this.seekTarget(this.target.pos());
    };
    Segment.prototype.seekTarget = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.a);
        this.deltaToTarget = deltaToTarget;
        this.a = targetPos.copy().add(deltaToTarget
            .copy()
            .normalize()
            .mult(-this.len));
        this.b = targetPos.copy();
    };
    return Segment;
}());
var Tentacle = (function () {
    function Tentacle(numSegments, fullLength, maxThickness, baseHueOf100, provideTarget) {
        var _this = this;
        var myHue = random(baseHueOf100 - 5, baseHueOf100 + 5);
        var avgSegmentLength = fullLength / numSegments;
        this.provideTarget = provideTarget;
        var prevPos = createVector(random(width * 0.4, width * 0.6), height * 1.1);
        this.segments = collectDistributedBetween(numSegments, 0, 0.9, function (thickness, ix) {
            var segment = Segment.createRandomAt("Seg" + ix, prevPos, null, 1 - thickness, maxThickness, avgSegmentLength, myHue);
            prevPos = segment.b.copy();
            return segment;
        });
        this.segments[0].isFixed = true;
        var thinnerSegment = null;
        this.segments.reverse().forEach(function (seg) {
            seg.target = thinnerSegment
                ? thinnerSegment
                : { pos: _this.provideTarget };
            thinnerSegment = seg;
        });
        this.segments.reverse();
    }
    Tentacle.prototype.update = function () {
        var originalLockedPos = this.segments[0].a.copy();
        this.segments.reverse();
        for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
            var s = _a[_i];
            s.update();
        }
        this.segments.reverse();
        var moveBackDelta = originalLockedPos
            .copy()
            .sub(this.segments[0].a.copy());
        this.segments.forEach(function (s) { return s.translate(moveBackDelta); });
    };
    Tentacle.prototype.draw = function () {
        if (appOptions.shouldDrawShadows) {
            for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
                var s = _a[_i];
                s.drawShadow();
            }
        }
        for (var _b = 0, _c = this.segments; _b < _c.length; _b++) {
            var s = _c[_b];
            s.drawSilhoutte();
        }
        for (var _d = 0, _e = this.segments; _d < _e.length; _d++) {
            var s = _e[_d];
            s.drawInner();
        }
    };
    return Tentacle;
}());
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function rotateVertexAround(vertex, rotOrigin, angleRad) {
    return vertex
        .copy()
        .sub(rotOrigin)
        .rotate(angleRad)
        .add(rotOrigin);
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        return fn(val);
    });
}
function collectDistributedBetween(numSamples, min, max, fn) {
    var result = [];
    distributeBetween(numSamples, min, max, function (v, ix) { return result.push(fn(v, ix)); });
    return result;
}
function distributeBetween(numSamples, min, max, fn) {
    repeat(numSamples, function (ix) {
        var range = max - min;
        var val = min + (ix * range) / numSamples;
        return fn(val, ix);
    });
}
function averageVectors(vs) {
    if (vs.length < 1) {
        return createVector(0, 0);
    }
    return vs.reduce(function (v1, v2) { return v1.copy().add(v2); }, vs[0]).div(vs.length);
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function collect(n, fn) {
    var res = [];
    for (var i = 0; i < n; i++) {
        res.push(fn(i));
    }
    return res;
}
p5.disableFriendlyErrors = true;
var defaultAppOptions = {
    shouldDrawShadows: true
};
var appOptions = defaultAppOptions;
var gNumTentacles = 5;
var gTentacles = [];
function randomAppOptions() {
    return {
        shouldDrawShadows: randomBoolean()
    };
}
function mouseHasMoved() {
    return dist(pmouseX, pmouseY, mouseX, mouseY) > 0;
}
function noisyMousePos(phase) {
    var amp = map(sin(frameCount / 20), -1, 1, 10, 40);
    var offsetX = map(noise(3 * phase + frameCount / 20), 0, 1, -amp, amp);
    var offsetY = map(noise(4 * phase + frameCount / 20), 0, 1, -amp, amp);
    return mousePosAsVector().add(createVector(offsetX, offsetY));
}
function makeTargetProvider(phase) {
    var perliner = makePerlinNoisePosFn(phase);
    return function () { return (mouseHasMoved() ? noisyMousePos(phase) : perliner()); };
}
function makePerlinNoisePosFn(phase) {
    return function () {
        return createVector(map(noise(phase + frameCount / 100), 0, 1, width / 2 - height * 0.3, width / 2 + height * 0.3), height * noise(88888 + phase + frameCount / 100));
    };
}
function rebuildTentacles() {
    var baseHue = random(100);
    gTentacles = collect(gNumTentacles, function (ix) {
        var targetProvider = makeTargetProvider(ix * 1000);
        return new Tentacle(200, height, random(80, 100), baseHue, targetProvider);
    });
}
function toggleShouldCastShadows() {
    appOptions.shouldDrawShadows = !appOptions.shouldDrawShadows;
}
function mousePressed() {
    rebuildTentacles();
}
function keyPressed() {
    if (key == "s") {
        toggleShouldCastShadows();
    }
}
function setup() {
    createCanvas(windowWidth, windowHeight);
    rebuildTentacles();
}
function update() {
    gTentacles.forEach(function (t) { return t.update(); });
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    gTentacles.forEach(function (t) { return t.draw(); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFsZXR0ZS50cyIsIlBhcnRpY2xlLnRzIiwiU2VnbWVudC50cyIsIlRlbnRhY2xlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFBQTtJQWFBLENBQUM7SUFaUSxpQkFBUyxHQUFoQjtRQUNFLE9BQU87WUFDTCxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztZQUNwQixLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUM7U0FDcEIsQ0FBQztJQUVKLENBQUM7SUFDTSxtQkFBVyxHQUFsQjtRQUNFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFDSCxjQUFDO0FBQUQsQ0FBQyxBQWJELElBYUM7QUNiRDtJQUdFLGtCQUFZLEdBQWM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUNELHVCQUFJLEdBQUo7UUFDRSxRQUFRLEVBQUUsQ0FBQztRQUNYLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNkLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFFRCw4QkFBVyxHQUFYLFVBQVksR0FBYztRQUN4QixJQUFJLENBQUMs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QUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUNyRCxPQUFPLElBQUksUUFBUSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDN0UsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyx1QkFBdUI7SUFDOUIsVUFBVSxDQUFDLGlCQUFpQixHQUFHLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDO0FBQy9ELENBQUM7QUFFRCxTQUFTLFlBQVk7SUFDbkIsZ0JBQWdCLEVBQUUsQ0FBQztBQUNyQixDQUFDO0FBQ0QsU0FBUyxVQUFVO0lBQ2pCLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRTtRQUNkLHVCQUF1QixFQUFFLENBQUM7S0FDM0I7QUFDSCxDQUFDO0FBSUQsU0FBUyxLQUFLO0lBQ1osWUFBWSxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN4QyxnQkFBZ0IsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFLRCxTQUFTLE1BQU07SUFDYixVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFLRCxTQUFTLElBQUk7SUFDWCxNQUFNLEVBQUUsQ0FBQztJQUNULFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNkLFFBQVEsRUFBRSxDQUFDO0lBQ1gsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBUixDQUFRLENBQUMsQ0FBQztBQUNwQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5wNS5kaXNhYmxlRnJpZW5kbHlFcnJvcnMgPSB0cnVlO1xuXG5pbnRlcmZhY2UgQXBwT3B0aW9ucyB7XG4gIHNob3VsZERyYXdTaGFkb3dzOiBib29sZWFuO1xufVxuXG5sZXQgZGVmYXVsdEFwcE9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XG4gIHNob3VsZERyYXdTaGFkb3dzOiB0cnVlXG59O1xuXG5sZXQgYXBwT3B0aW9uczogQXBwT3B0aW9ucyA9IGRlZmF1bHRBcHBPcHRpb25zO1xuXG5jb25zdCBnTnVtVGVudGFjbGVzID0gNTtcbmxldCBnVGVudGFjbGVzOiBUZW50YWNsZVtdID0gW107XG5cbmZ1bmN0aW9uIHJhbmRvbUFwcE9wdGlvbnMoKTogQXBwT3B0aW9ucyB7XG4gIHJldHVybiB7XG4gICAgc2hvdWxkRHJhd1NoYWRvd3M6IHJhbmRvbUJvb2xlYW4oKVxuICB9O1xufVxuXG5mdW5jdGlvbiBtb3VzZUhhc01vdmVkKCkge1xuICByZXR1cm4gZGlzdChwbW91c2VYLCBwbW91c2VZLCBtb3VzZVgsIG1vdXNlWSkgPiAwO1xufVxuXG5mdW5jdGlvbiBub2lzeU1vdXNlUG9zKHBoYXNlOiBudW1iZXIpIHtcbiAgLy91bmR1bGF0aW5nIGF0dGVudGlvblxuICBjb25zdCBhbXAgPSBtYXAoc2luKGZyYW1lQ291bnQgLyAyMCksIC0xLCAxLCAxMCwgNDApO1xuXG4gIGNvbnN0IG9mZnNldFggPSBtYXAobm9pc2UoMyAqIHBoYXNlICsgZnJhbWVDb3VudCAvIDIwKSwgMCwgMSwgLWFtcCwgYW1wKTtcbiAgY29uc3Qgb2Zmc2V0WSA9IG1hcChub2lzZSg0ICogcGhhc2UgKyBmcmFtZUNvdW50IC8gMjApLCAwLCAxLCAtYW1wLCBhbXApO1xuICByZXR1cm4gbW91c2VQb3NBc1ZlY3RvcigpLmFkZChjcmVhdGVWZWN0b3Iob2Zmc2V0WCwgb2Zmc2V0WSkpO1xufVxuXG5mdW5jdGlvbiBtYWtlVGFyZ2V0UHJvdmlkZXIocGhhc2U6IG51bWJlcikge1xuICAvLy9UT0RPOiBuZXZlciBwdXQgYSB0YXJnZXQgY29tcGxldGVseSBvdXQgb2YgcmVhY2ggYXMgc3lzdGVtIHN0cmV0Y2hlc1xuICAvLyBvdXQgdW5uYXR1cmFsbHksIGlub3JnYW5pY2FsbHkgc3RyYWlnaHQuXG4gIC8vL0luc3RlYWQgaWYgdGFyZ2V0IHdvdWxkIGJlIG91dCBvZiByZWFjaCBicmluZyBpdCBqdXN0IHdpdGhpbiByZWFjaCwgb24gc2FtZSBsaW5lLlxuICBjb25zdCBwZXJsaW5lciA9IG1ha2VQZXJsaW5Ob2lzZVBvc0ZuKHBoYXNlKTtcbiAgcmV0dXJuICgpID0+IChtb3VzZUhhc01vdmVkKCkgPyBub2lzeU1vdXNlUG9zKHBoYXNlKSA6IHBlcmxpbmVyKCkpO1xufVxuZnVuY3Rpb24gbWFrZVBlcmxpbk5vaXNlUG9zRm4ocGhhc2U6IG51bWJlcikge1xuICByZXR1cm4gKCkgPT5cbiAgICBjcmVhdGVWZWN0b3IoXG4gICAgICBtYXAoXG4gICAgICAgIG5vaXNlKHBoYXNlICsgZnJhbWVDb3VudCAvIDEwMCksXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIHdpZHRoIC8gMiAtIGhlaWdodCAqIDAuMyxcbiAgICAgICAgd2lkdGggLyAyICsgaGVpZ2h0ICogMC4zXG4gICAgICApLFxuICAgICAgaGVpZ2h0ICogbm9pc2UoODg4ODggKyBwaGFzZSArIGZyYW1lQ291bnQgLyAxMDApXG4gICAgKTtcbn1cbmZ1bmN0aW9uIHJlYnVpbGRUZW50YWNsZXMoKSB7XG4gIGNvbnN0IGJhc2VIdWUgPSByYW5kb20oMTAwKTtcbiAgZ1RlbnRhY2xlcyA9IGNvbGxlY3QoZ051bVRlbnRhY2xlcywgaXggPT4ge1xuICAgIGNvbnN0IHRhcmdldFByb3ZpZGVyID0gbWFrZVRhcmdldFByb3ZpZGVyKGl4ICogMTAwMCk7XG4gICAgcmV0dXJuIG5ldyBUZW50YWNsZSgyMDAsIGhlaWdodCwgcmFuZG9tKDgwLCAxMDApLCBiYXNlSHVlLCB0YXJnZXRQcm92aWRlcik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVTaG91bGRDYXN0U2hhZG93cygpIHtcbiAgYXBwT3B0aW9ucy5zaG91bGREcmF3U2hhZG93cyA9ICFhcHBPcHRpb25zLnNob3VsZERyYXdTaGFkb3dzO1xufVxuXG5mdW5jdGlvbiBtb3VzZVByZXNzZWQoKSB7XG4gIHJlYnVpbGRUZW50YWNsZXMoKTtcbn1cbmZ1bmN0aW9uIGtleVByZXNzZWQoKSB7XG4gIGlmIChrZXkgPT0gXCJzXCIpIHtcbiAgICB0b2dnbGVTaG91bGRDYXN0U2hhZG93cygpO1xuICB9XG59XG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gU0VUVVBcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuICByZWJ1aWxkVGVudGFjbGVzKCk7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBVUERBVEVcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIGdUZW50YWNsZXMuZm9yRWFjaCh0ID0+IHQudXBkYXRlKCkpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRFJBV1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gIHVwZGF0ZSgpO1xuICBiYWNrZ3JvdW5kKDApO1xuICBmaWxsKFwiYmxhY2tcIik7XG4gIG5vU3Ryb2tlKCk7XG4gIGdUZW50YWNsZXMuZm9yRWFjaCh0ID0+IHQuZHJhdygpKTtcbn1cbiIsImNsYXNzIFBhbGV0dGUge1xuICBzdGF0aWMgZ2V0Q29sb3JzKCkge1xuICAgIHJldHVybiBbXG4gICAgICBjb2xvcigyNTAsIDEwNSwgMCksXG4gICAgICBjb2xvcigxMDUsIDIxMCwgMjMxKSxcbiAgICAgIGNvbG9yKDE2NywgMjE5LCAyMTYpLFxuICAgICAgY29sb3IoMjQzLCAxMzQsIDQ4KVxuICAgIF07XG4gICAgXG4gIH1cbiAgc3RhdGljIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgICByZXR1cm4gcmFuZG9tKFBhbGV0dGUuZ2V0Q29sb3JzKCkpO1xuICB9XG59XG4iLCJjbGFzcyBQYXJ0aWNsZSB7XG4gIHBvczogcDUuVmVjdG9yO1xuXG4gIGNvbnN0cnVjdG9yKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MgPSBwb3MuY29weSgpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgbm9TdHJva2UoKTtcbiAgICBmaWxsKFwiYmxhY2tcIik7XG4gICAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgICBzcXVhcmUodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMyk7XG4gICAgZmlsbCgwLCAyMCk7XG4gIH1cblxuICBzZXRQb3NpdGlvbihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMucG9zLnggPSBwb3MueDtcbiAgICB0aGlzLnBvcy55ID0gcG9zLnk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUocmFuZG9tU2NyZWVuUG9zaXRpb24oKSk7XG4gIH1cbn1cbiIsImludGVyZmFjZSBUYXJnZXQge1xuICBwb3MoKTogcDUuVmVjdG9yO1xufVxuZnVuY3Rpb24gcmFuZG9tQ29sb3IoKTogcDUuQ29sb3Ige1xuICBjb2xvck1vZGUoSFNCLCAxMDApO1xuICByZXR1cm4gY29sb3IocmFuZG9tKDEwMCksIDEwMCwgMTAwKTtcbn1cbmNsYXNzIFNlZ21lbnQgaW1wbGVtZW50cyBUYXJnZXQge1xuICBkZWx0YVRvVGFyZ2V0OiBwNS5WZWN0b3I7XG4gIGE6IHA1LlZlY3RvcjtcbiAgYjogcDUuVmVjdG9yO1xuICBpZDogc3RyaW5nO1xuICBteUNvbG9yOiBwNS5Db2xvcjtcbiAgZWRnZUNvbG9yOiBwNS5Db2xvcjtcbiAgdGhpY2tuZXNzOiBudW1iZXI7XG4gIGxlbjogbnVtYmVyO1xuICBpc0ZpeGVkOiBib29sZWFuO1xuICB0YXJnZXQ6IFRhcmdldDtcbiAgdGFyZ2V0Q29sb3I6IHA1LkNvbG9yO1xuICBteUh1ZTogbnVtYmVyO1xuICBjb25zdHJ1Y3RvcihcbiAgICBpZDogc3RyaW5nLFxuICAgIGE6IHA1LlZlY3RvcixcbiAgICBiOiBwNS5WZWN0b3IsXG4gICAgdGFyZ2V0OiBUYXJnZXQsXG4gICAgdGhpY2tuZXNzU2NhbGU6IG51bWJlcixcbiAgICBtYXhUaGlja25lc3M6IG51bWJlcixcbiAgICBteUh1ZTogbnVtYmVyXG4gICkge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmEgPSBhLmNvcHkoKTtcbiAgICB0aGlzLmIgPSBiLmNvcHkoKTtcbiAgICB0aGlzLmlzRml4ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmxlbiA9IGEuZGlzdChiKTtcbiAgICBjb2xvck1vZGUoSFNCLCAxMDApO1xuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMubXlIdWUgPSBteUh1ZTtcbiAgICBjb25zdCBzYXQgPSA1MDtcbiAgICBjb25zdCBicmlnaHQgPSA1MDtcbiAgICB0aGlzLm15Q29sb3IgPSBjb2xvcih0aGlzLm15SHVlLCBzYXQsIHJhbmRvbShicmlnaHQgLSAxMCwgYnJpZ2h0ICsgMTApKTtcbiAgICB0aGlzLmVkZ2VDb2xvciA9IGNvbG9yKHRoaXMubXlIdWUsIHNhdCwgYnJpZ2h0IC0gMjApO1xuICAgIHRoaXMudGhpY2tuZXNzID0gdGhpY2tuZXNzU2NhbGUgKiBtYXhUaGlja25lc3MgKiByYW5kb20oMC45LCAxLjEpO1xuICAgIHRoaXMudGFyZ2V0Q29sb3IgPSByYW5kb21Db2xvcigpO1xuICB9XG4gIHBvcygpOiBwNS5WZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmEuY29weSgpO1xuICB9XG4gIHRyYW5zbGF0ZShvZmZzZXQ6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMuYS5hZGQob2Zmc2V0KTtcbiAgICB0aGlzLmIuYWRkKG9mZnNldCk7XG4gIH1cbiAgZHJhd1NoYWRvdygpIHtcbiAgICBjb25zdCBvZmYgPSBjcmVhdGVWZWN0b3IoMjAsIDEwKTtcbiAgICBzdHJva2UoY29sb3IodGhpcy5teUh1ZSwgMCwgMCwgMjApKTtcbiAgICBub0ZpbGwoKTtcbiAgICBzdHJva2VXZWlnaHQodGhpcy50aGlja25lc3MpO1xuICAgIGxpbmUoXG4gICAgICBvZmYueCArIHRoaXMuYS54LFxuICAgICAgb2ZmLnkgKyB0aGlzLmEueSxcbiAgICAgIG9mZi54ICsgdGhpcy5iLngsXG4gICAgICBvZmYueSArIHRoaXMuYi55XG4gICAgKTtcbiAgfVxuICBkcmF3U2lsaG91dHRlKCkge1xuICAgIG5vRmlsbCgpO1xuICAgIHN0cm9rZSgxMCk7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzKTtcbiAgICBsaW5lKHRoaXMuYS54LCB0aGlzLmEueSwgdGhpcy5iLngsIHRoaXMuYi55KTtcbiAgfVxuICBkcmF3SW5uZXIoKSB7XG4gICAgLy9zdHJva2VDYXAoU1FVQVJFKTtcbiAgICBzdHJva2UodGhpcy5teUNvbG9yKTtcbiAgICBzdHJva2VXZWlnaHQodGhpcy50aGlja25lc3MgKiAwLjgpO1xuICAgIGxpbmUodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuICB9XG4gIHN0YXRpYyBkcmF3Q3Jvc3NoYWlyQXQocG9zOiBwNS5WZWN0b3IsIGNvbHI6IHA1LkNvbG9yKSB7XG4gICAgc3Ryb2tlV2VpZ2h0KDEuOCk7XG4gICAgc3Ryb2tlKGNvbHIpO1xuICAgIHB1c2goKTtcbiAgICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbiAgICBsaW5lKC04LCAwLCA4LCAwKTtcbiAgICBsaW5lKDAsIC04LCAwLCA4KTtcbiAgICBwb3AoKTtcbiAgfVxuICBtaWRQb2ludCgpOiBwNS5WZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmEuY29weSgpLmxlcnAodGhpcy5iLCAwLjUpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbUF0KFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcG9zQTogcDUuVmVjdG9yLFxuICAgIHRhcmdldDogVGFyZ2V0LFxuICAgIHRoaWNrbmVzc1NjYWxlOiBudW1iZXIsXG4gICAgbWF4VGhpY2tuZXNzOiBudW1iZXIsXG4gICAgbGVuOiBudW1iZXIsXG4gICAgbXlIdWU6IG51bWJlclxuICApIHtcbiAgICBjb25zdCBwMSA9IHBvc0EuY29weSgpO1xuICAgIGNvbnN0IHAyID0gcDEuY29weSgpLmFkZChwNS5WZWN0b3IucmFuZG9tMkQoKS5tdWx0KGxlbikpO1xuICAgIHJldHVybiBuZXcgU2VnbWVudChpZCwgcDEsIHAyLCB0YXJnZXQsIHRoaWNrbmVzc1NjYWxlLCBtYXhUaGlja25lc3MsIG15SHVlKTtcbiAgfVxuICB1cGRhdGUoKTogdm9pZCB7XG4gICAgdGhpcy5zZWVrVGFyZ2V0KHRoaXMudGFyZ2V0LnBvcygpKTtcbiAgfVxuXG4gIHNlZWtUYXJnZXQodGFyZ2V0UG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBkZWx0YVRvVGFyZ2V0ID0gdGFyZ2V0UG9zLmNvcHkoKS5zdWIodGhpcy5hKTtcbiAgICB0aGlzLmRlbHRhVG9UYXJnZXQgPSBkZWx0YVRvVGFyZ2V0O1xuICAgIHRoaXMuYSA9IHRhcmdldFBvcy5jb3B5KCkuYWRkKFxuICAgICAgZGVsdGFUb1RhcmdldFxuICAgICAgICAuY29weSgpXG4gICAgICAgIC5ub3JtYWxpemUoKVxuICAgICAgICAubXVsdCgtdGhpcy5sZW4pXG4gICAgKTtcbiAgICB0aGlzLmIgPSB0YXJnZXRQb3MuY29weSgpO1xuICB9XG59XG4iLCJjbGFzcyBUZW50YWNsZSB7XG4gIHNlZ21lbnRzOiBTZWdtZW50W107XG4gIHByb3ZpZGVUYXJnZXQ6ICgpID0+IHA1LlZlY3RvcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBudW1TZWdtZW50czogbnVtYmVyLFxuICAgIGZ1bGxMZW5ndGg6IG51bWJlcixcbiAgICBtYXhUaGlja25lc3M6IG51bWJlcixcbiAgICBiYXNlSHVlT2YxMDA6IG51bWJlcixcbiAgICBwcm92aWRlVGFyZ2V0OiAoKSA9PiBwNS5WZWN0b3JcbiAgKSB7XG4gICAgY29uc3QgbXlIdWUgPSByYW5kb20oYmFzZUh1ZU9mMTAwIC0gNSwgYmFzZUh1ZU9mMTAwICsgNSk7XG4gICAgY29uc3QgYXZnU2VnbWVudExlbmd0aCA9IGZ1bGxMZW5ndGggLyBudW1TZWdtZW50cztcbiAgICB0aGlzLnByb3ZpZGVUYXJnZXQgPSBwcm92aWRlVGFyZ2V0O1xuXG4gICAgbGV0IHByZXZQb3M6IHA1LlZlY3RvciA9IGNyZWF0ZVZlY3RvcihcbiAgICAgIHJhbmRvbSh3aWR0aCAqIDAuNCwgd2lkdGggKiAwLjYpLFxuICAgICAgaGVpZ2h0ICogMS4xXG4gICAgKTtcbiAgICB0aGlzLnNlZ21lbnRzID0gY29sbGVjdERpc3RyaWJ1dGVkQmV0d2VlbihcbiAgICAgIG51bVNlZ21lbnRzLFxuICAgICAgMCxcbiAgICAgIDAuOSxcbiAgICAgICh0aGlja25lc3MsIGl4KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlZ21lbnQgPSBTZWdtZW50LmNyZWF0ZVJhbmRvbUF0KFxuICAgICAgICAgIFwiU2VnXCIgKyBpeCxcbiAgICAgICAgICBwcmV2UG9zLFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICAgMSAtIHRoaWNrbmVzcyxcbiAgICAgICAgICBtYXhUaGlja25lc3MsXG4gICAgICAgICAgYXZnU2VnbWVudExlbmd0aCxcbiAgICAgICAgICBteUh1ZVxuICAgICAgICApO1xuICAgICAgICBwcmV2UG9zID0gc2VnbWVudC5iLmNvcHkoKTtcbiAgICAgICAgcmV0dXJuIHNlZ21lbnQ7XG4gICAgICB9XG4gICAgKTtcbiAgICB0aGlzLnNlZ21lbnRzWzBdLmlzRml4ZWQgPSB0cnVlO1xuXG4gICAgbGV0IHRoaW5uZXJTZWdtZW50OiBTZWdtZW50ID0gbnVsbDtcbiAgICB0aGlzLnNlZ21lbnRzLnJldmVyc2UoKS5mb3JFYWNoKHNlZyA9PiB7XG4gICAgICBzZWcudGFyZ2V0ID0gdGhpbm5lclNlZ21lbnRcbiAgICAgICAgPyB0aGlubmVyU2VnbWVudFxuICAgICAgICA6IHsgcG9zOiB0aGlzLnByb3ZpZGVUYXJnZXQgfTtcbiAgICAgIHRoaW5uZXJTZWdtZW50ID0gc2VnO1xuICAgIH0pO1xuICAgIHRoaXMuc2VnbWVudHMucmV2ZXJzZSgpO1xuICB9XG4gIHVwZGF0ZSgpIHtcbiAgICBjb25zdCBvcmlnaW5hbExvY2tlZFBvcyA9IHRoaXMuc2VnbWVudHNbMF0uYS5jb3B5KCk7XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCk7XG4gICAgZm9yIChsZXQgcyBvZiB0aGlzLnNlZ21lbnRzKSB7XG4gICAgICBzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICB0aGlzLnNlZ21lbnRzLnJldmVyc2UoKTtcbiAgICBjb25zdCBtb3ZlQmFja0RlbHRhID0gb3JpZ2luYWxMb2NrZWRQb3NcbiAgICAgIC5jb3B5KClcbiAgICAgIC5zdWIodGhpcy5zZWdtZW50c1swXS5hLmNvcHkoKSk7XG4gICAgdGhpcy5zZWdtZW50cy5mb3JFYWNoKHMgPT4gcy50cmFuc2xhdGUobW92ZUJhY2tEZWx0YSkpO1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICBpZiAoYXBwT3B0aW9ucy5zaG91bGREcmF3U2hhZG93cykge1xuICAgICAgZm9yIChsZXQgcyBvZiB0aGlzLnNlZ21lbnRzKSB7XG4gICAgICAgIHMuZHJhd1NoYWRvdygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3U2lsaG91dHRlKCk7XG4gICAgfVxuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3SW5uZXIoKTtcbiAgICB9XG4gIH1cbn1cbiIsImZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiBjZW50ZXJTY3JlZW5Qb3MoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRleEFyb3VuZChcbiAgdmVydGV4OiBwNS5WZWN0b3IsXG4gIHJvdE9yaWdpbjogcDUuVmVjdG9yLFxuICBhbmdsZVJhZDogbnVtYmVyXG4pOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gdmVydGV4XG4gICAgLmNvcHkoKVxuICAgIC5zdWIocm90T3JpZ2luKVxuICAgIC5yb3RhdGUoYW5nbGVSYWQpXG4gICAgLmFkZChyb3RPcmlnaW4pO1xufVxuXG4vKiogRmluZCB0aGUgbWluaW11bSBvZiB0aGUgZ2l2ZW4gbGlzdCBhZnRlciBhcHBseWluZyBmbigpIHRvIGVhY2guXG4gKiBSZXR1cm4gdGhlIG1pbmltdW0sIGZpcnN0IG1pbmltdW0sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbm8gaXRlbXMuXG4gKi9cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgbGV0IHJlY29yZEl0ZW0gPSBsaXN0WzBdO1xuICBsZXQgcmVjb3JkV2VpZ2h0ID0gZm4obGlzdFswXSk7XG4gIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xuICAgIGNvbnN0IHdlaWdodCA9IGZuKGl0ZW0pO1xuICAgIGlmICh3ZWlnaHQgPiByZWNvcmRXZWlnaHQpIHtcbiAgICAgIHJlY29yZFdlaWdodCA9IHdlaWdodDtcbiAgICAgIHJlY29yZEl0ZW0gPSBpdGVtO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVjb3JkSXRlbTtcbn1cblxuLyoqIFJlcGVhdGVkbHkgY2FsbCB0aGUgZ2l2ZW4gZnVuY3Rpb24gZm4sIG51bSB0aW1lcywgdGhyb3dpbmcgYW55IG91dHB1dCBhd2F5LiAqL1xuZnVuY3Rpb24gcmVwZWF0KG51bTogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgIGZuKGkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVVcFRvKHRvdGFsOiBudW1iZXIsIG1heDogbnVtYmVyLCBmbjogKHY6IG51bWJlcikgPT4gdm9pZCkge1xuICByZXBlYXQodG90YWwsIGl4ID0+IHtcbiAgICBjb25zdCB2YWwgPSAoaXggKiBtYXgpIC8gdG90YWw7XG4gICAgcmV0dXJuIGZuKHZhbCk7XG4gIH0pO1xufVxuLyoqIFxuQ29sbGVjdCBhIHNldCBvZiB2YWx1ZXMgZ2VuZXJhdGVkIHdpdGggZm4gY2FsbGVkIHdpdGggXG5hIHJhbmdlIG9mIG51bVNhbXBsZXMgc2FtcGxlcyBkaXN0cmlidXRlZCBldmVubHkgZnJvbSBtaW4gdG8gbWF4LlxuKi9cbmZ1bmN0aW9uIGNvbGxlY3REaXN0cmlidXRlZEJldHdlZW48VD4oXG4gIG51bVNhbXBsZXM6IG51bWJlcixcbiAgbWluOiBudW1iZXIsXG4gIG1heDogbnVtYmVyLFxuICBmbjogKHY6IG51bWJlciwgaXg/OiBudW1iZXIpID0+IFRcbik6IFRbXSB7XG4gIGNvbnN0IHJlc3VsdDogVFtdID0gW107XG4gIGRpc3RyaWJ1dGVCZXR3ZWVuKG51bVNhbXBsZXMsIG1pbiwgbWF4LCAodiwgaXgpID0+IHJlc3VsdC5wdXNoKGZuKHYsIGl4KSkpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gZGlzdHJpYnV0ZUJldHdlZW4oXG4gIG51bVNhbXBsZXM6IG51bWJlcixcbiAgbWluOiBudW1iZXIsXG4gIG1heDogbnVtYmVyLFxuICBmbjogKHY6IG51bWJlciwgaXg/OiBudW1iZXIpID0+IHZvaWRcbikge1xuICByZXBlYXQobnVtU2FtcGxlcywgaXggPT4ge1xuICAgIGNvbnN0IHJhbmdlID0gbWF4IC0gbWluO1xuICAgIGNvbnN0IHZhbCA9IG1pbiArIChpeCAqIHJhbmdlKSAvIG51bVNhbXBsZXM7XG4gICAgcmV0dXJuIGZuKHZhbCwgaXgpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGF2ZXJhZ2VWZWN0b3JzKHZzOiBwNS5WZWN0b3JbXSk6IHA1LlZlY3RvciB7XG4gIGlmICh2cy5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIGNyZWF0ZVZlY3RvcigwLCAwKTtcbiAgfVxuICByZXR1cm4gdnMucmVkdWNlKCh2MSwgdjIpID0+IHYxLmNvcHkoKS5hZGQodjIpLCB2c1swXSkuZGl2KHZzLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUJvb2xlYW4oKTogYm9vbGVhbiB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpID4gMC41O1xufVxuZnVuY3Rpb24gbW91c2VQb3NBc1ZlY3RvcigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKG1vdXNlWCwgbW91c2VZKTtcbn1cbmZ1bmN0aW9uIGNvbGxlY3Q8VD4objogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IFQpOiBUW10ge1xuICBjb25zdCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICByZXMucHVzaChmbihpKSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cbiJdfQ==