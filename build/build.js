"use strict";
var Palette = (function () {
    function Palette() {
    }
    Palette.getColors = function () {
        return [
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ];
    };
    Palette.randomColor = function () {
        return random(Palette.getColors());
    };
    return Palette;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
        this.heading = 0;
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.update = function () {
        var mouseMovementAngle = angleOfLastMouseMovement();
        if (mouseMovementAngle !== undefined) {
            this.heading = mouseMovementAngle;
        }
    };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
function randomColor() {
    colorMode(HSB, 100);
    return color(random(100), 100, 100);
}
var Segment = (function () {
    function Segment(id, a, b, target, thicknessScale, myHue) {
        this.id = id;
        this.a = a.copy();
        this.b = b.copy();
        this.isFixed = false;
        this.len = a.dist(b);
        colorMode(HSB, 100);
        this.target = target;
        this.myHue = myHue;
        var sat = 50;
        var bright = 50;
        this.myColor = color(this.myHue, sat, random(bright - 10, bright + 10));
        this.edgeColor = color(this.myHue, sat, bright - 20);
        this.thickness = thicknessScale * 50 * random(0.9, 1.1);
        this.targetColor = randomColor();
    }
    Segment.prototype.pos = function () {
        return this.a.copy();
    };
    Segment.prototype.drawSilhoutte = function () {
        stroke(this.edgeColor);
        noFill();
        stroke(10);
        strokeWeight(this.thickness);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.prototype.drawInner = function () {
        stroke(this.myColor);
        strokeWeight(this.thickness * 0.8);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Segment.drawCrosshairAt = function (pos, colr) {
        strokeWeight(1.8);
        stroke(colr);
        push();
        translate(pos.x, pos.y);
        line(-8, 0, 8, 0);
        line(0, -8, 0, 8);
        pop();
    };
    Segment.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Segment.createRandomAt = function (id, posA, target, thicknessScale, len, myHue) {
        var p1 = posA.copy();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(len));
        return new Segment(id, p1, p2, target, thicknessScale, myHue);
    };
    Segment.prototype.update = function () {
        this.seekTarget(this.target.pos());
    };
    Segment.prototype.seekTarget = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.a);
        this.deltaToTarget = deltaToTarget;
        this.a = targetPos.copy().add(deltaToTarget
            .copy()
            .normalize()
            .mult(-this.len));
        this.b = targetPos.copy();
    };
    return Segment;
}());
var Tentacle = (function () {
    function Tentacle(numSegments, fullLength, baseHueOf100, provideTarget) {
        var _this = this;
        var prevPos = createVector(width / 2, height * 1.1);
        var myHue = random(baseHueOf100 - 5, baseHueOf100 + 5);
        var avgSegmentLength = fullLength / numSegments;
        this.provideTarget = provideTarget;
        this.segments = collectDistributedBetween(numSegments, 0, 0.9, function (thickness, ix) {
            var segment = Segment.createRandomAt("Seg" + ix, prevPos, null, 1 - thickness, avgSegmentLength, myHue);
            prevPos = segment.b.copy();
            return segment;
        });
        this.segments[0].isFixed = true;
        var thinnerSegment = null;
        this.segments.reverse().forEach(function (seg) {
            seg.target = thinnerSegment
                ? thinnerSegment
                : { pos: _this.provideTarget };
            thinnerSegment = seg;
        });
        this.segments.reverse();
    }
    Tentacle.prototype.update = function () {
        this.segments.reverse();
        for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
            var s = _a[_i];
            s.update();
        }
        this.segments.reverse();
    };
    Tentacle.prototype.draw = function () {
        for (var _i = 0, _a = this.segments; _i < _a.length; _i++) {
            var s = _a[_i];
            s.drawSilhoutte();
        }
        for (var _b = 0, _c = this.segments; _b < _c.length; _b++) {
            var s = _c[_b];
            s.drawInner();
        }
    };
    return Tentacle;
}());
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function rotateVertexAround(vertex, rotOrigin, angleRad) {
    return vertex
        .copy()
        .sub(rotOrigin)
        .rotate(angleRad)
        .add(rotOrigin);
}
function collideLineLine(x1, y1, x2, y2, x3, y3, x4, y4) {
    var uA = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    var uB = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {
        var intersectionX = x1 + uA * (x2 - x1);
        var intersectionY = y1 + uA * (y2 - y1);
        return createVector(intersectionX, intersectionY);
    }
    return null;
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        return fn(val);
    });
}
function collectDistributedBetween(numSamples, min, max, fn) {
    var result = [];
    distributeBetween(numSamples, min, max, function (v, ix) { return result.push(fn(v, ix)); });
    return result;
}
function distributeBetween(numSamples, min, max, fn) {
    repeat(numSamples, function (ix) {
        var range = max - min;
        var val = min + (ix * range) / numSamples;
        return fn(val, ix);
    });
}
function averageVectors(vs) {
    if (vs.length < 1) {
        return createVector(0, 0);
    }
    return vs.reduce(function (v1, v2) { return v1.copy().add(v2); }, vs[0]).div(vs.length);
}
var gLastMouseMovements = [];
function angleOfLastMouseMovement() {
    var delta = createVector(mouseX - pmouseX, mouseY - pmouseY);
    if (delta.magSq() < 1) {
        return undefined;
    }
    else {
        gLastMouseMovements.unshift(delta);
        gLastMouseMovements.splice(8);
        var avgMovement = averageVectors(gLastMouseMovements);
        if (avgMovement.mag() > 0) {
            return avgMovement.heading();
        }
        else {
            return undefined;
        }
    }
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
p5.disableFriendlyErrors = true;
var testSegment;
var appOptions = randomAppOptions();
var defaultAppOptions = {
    isMovingStructures: true
};
function randomAppOptions() {
    return {
        isMovingStructures: randomBoolean()
    };
}
var gNumTentacles = 5;
var gTentacles = [];
function collect(n, fn) {
    var res = [];
    for (var i = 0; i < n; i++) {
        res.push(fn(i));
    }
    return res;
}
function mouseHasMoved() {
    return dist(pmouseX, pmouseY, mouseX, mouseY) > 4;
}
function makeTargetProvider(phase) {
    var perliner = makePerlinNoisePosFn(phase);
    return function () { return (mouseHasMoved() ? mousePosAsVector() : perliner()); };
}
function makePerlinNoisePosFn(phase) {
    return function () {
        return createVector(map(noise(phase + frameCount / 100), 0, 1, width / 2 - height * 0.3, width / 2 + height * 0.3), height * noise(88888 + phase + frameCount / 100));
    };
}
function setup() {
    createCanvas(windowWidth, windowHeight);
    var baseHue = random(100);
    gTentacles = collect(4, function (ix) {
        var targetProvider = makeTargetProvider(ix * 1000);
        return new Tentacle(200, height, baseHue, targetProvider);
    });
    frameRate(30);
    testSegment = new Segment("test", createVector(300, 300), createVector(350, 300), { pos: mousePosAsVector }, 1, 0);
}
function update() {
    gTentacles.forEach(function (t) { return t.update(); });
    testSegment.update();
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    gTentacles.forEach(function (t) { return t.draw(); });
}
function toggleMovingStructures() {
    appOptions.isMovingStructures = !appOptions.isMovingStructures;
}
function mousePressed() { }
function keyPressed() {
    if (key == " ") {
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFsZXR0ZS50cyIsIlBhcnRpY2xlLnRzIiwiU2VnbWVudC50cyIsIlRlbnRhY2xlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFBQTtJQVlBLENBQUM7SUFYUSxpQkFBUyxHQUFoQjtRQUNFLE9BQU87WUFDTCxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztZQUNwQixLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUM7U0FDcEIsQ0FBQztJQUNKLENBQUM7SUFDTSxtQkFBVyxHQUFsQjtRQUNFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFDSCxjQUFDO0FBQUQsQ0FBQyxBQVpELElBWUM7QUNaRDtJQUlFLGtCQUFZLEdBQWM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUNELHVCQUFJLEdBQUo7UUFDRSxRQUFRLEVBQUUsQ0FBQztRQUNYLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNkLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFDRCx5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LEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVU7SUFHVixJQUFJLEVBQUUsR0FDSixDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNsRCxJQUFJLEVBQUUsR0FDSixDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUdsRCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFFNUMsSUFBSSxhQUFhLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN4QyxJQUFJLGFBQWEsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBRXhDLE9BQU8sWUFBWSxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsQ0FBQztLQUNuRDtJ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SCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5wNS5kaXNhYmxlRnJpZW5kbHlFcnJvcnMgPSB0cnVlO1xuXG5sZXQgdGVzdFNlZ21lbnQ6IFNlZ21lbnQ7XG5cbmxldCBhcHBPcHRpb25zOiBBcHBPcHRpb25zID0gcmFuZG9tQXBwT3B0aW9ucygpO1xuXG5pbnRlcmZhY2UgQXBwT3B0aW9ucyB7XG4gIGlzTW92aW5nU3RydWN0dXJlczogYm9vbGVhbjtcbn1cbmxldCBkZWZhdWx0QXBwT3B0aW9uczogQXBwT3B0aW9ucyA9IHtcbiAgaXNNb3ZpbmdTdHJ1Y3R1cmVzOiB0cnVlXG59O1xuXG5mdW5jdGlvbiByYW5kb21BcHBPcHRpb25zKCk6IEFwcE9wdGlvbnMge1xuICByZXR1cm4ge1xuICAgIGlzTW92aW5nU3RydWN0dXJlczogcmFuZG9tQm9vbGVhbigpXG4gIH07XG59XG5cbmNvbnN0IGdOdW1UZW50YWNsZXMgPSA1O1xubGV0IGdUZW50YWNsZXM6IFRlbnRhY2xlW10gPSBbXTtcbmZ1bmN0aW9uIGNvbGxlY3Q8VD4objogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IFQpOiBUW10ge1xuICBjb25zdCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICByZXMucHVzaChmbihpKSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cbmZ1bmN0aW9uIG1vdXNlSGFzTW92ZWQoKSB7XG4gIHJldHVybiBkaXN0KHBtb3VzZVgsIHBtb3VzZVksIG1vdXNlWCwgbW91c2VZKSA+IDQ7XG59XG5mdW5jdGlvbiBtYWtlVGFyZ2V0UHJvdmlkZXIocGhhc2U6IG51bWJlcikge1xuICBjb25zdCBwZXJsaW5lciA9IG1ha2VQZXJsaW5Ob2lzZVBvc0ZuKHBoYXNlKTtcbiAgcmV0dXJuICgpID0+IChtb3VzZUhhc01vdmVkKCkgPyBtb3VzZVBvc0FzVmVjdG9yKCkgOiBwZXJsaW5lcigpKTtcbn1cbmZ1bmN0aW9uIG1ha2VQZXJsaW5Ob2lzZVBvc0ZuKHBoYXNlOiBudW1iZXIpIHtcbiAgcmV0dXJuICgpID0+XG4gICAgY3JlYXRlVmVjdG9yKFxuICAgICAgbWFwKFxuICAgICAgICBub2lzZShwaGFzZSArIGZyYW1lQ291bnQgLyAxMDApLFxuICAgICAgICAwLFxuICAgICAgICAxLFxuICAgICAgICB3aWR0aCAvIDIgLSBoZWlnaHQgKiAwLjMsXG4gICAgICAgIHdpZHRoIC8gMiArIGhlaWdodCAqIDAuM1xuICAgICAgKSxcbiAgICAgIGhlaWdodCAqIG5vaXNlKDg4ODg4ICsgcGhhc2UgKyBmcmFtZUNvdW50IC8gMTAwKVxuICAgICk7XG59XG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFNFVFVQXG4gKi9cbmZ1bmN0aW9uIHNldHVwKCkge1xuICBjcmVhdGVDYW52YXMod2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCk7XG4gIGNvbnN0IGJhc2VIdWUgPSByYW5kb20oMTAwKTtcblxuICBnVGVudGFjbGVzID0gY29sbGVjdCg0LCBpeCA9PiB7XG4gICAgY29uc3QgdGFyZ2V0UHJvdmlkZXIgPSBtYWtlVGFyZ2V0UHJvdmlkZXIoaXggKiAxMDAwKTtcbiAgICByZXR1cm4gbmV3IFRlbnRhY2xlKDIwMCwgaGVpZ2h0LCBiYXNlSHVlLCB0YXJnZXRQcm92aWRlcik7XG4gIH0pO1xuICAvL2dUZW50YWNsZXMubGVuZ3RoID0gMDtcbiAgZnJhbWVSYXRlKDMwKTtcbiAgdGVzdFNlZ21lbnQgPSBuZXcgU2VnbWVudChcbiAgICBcInRlc3RcIixcbiAgICBjcmVhdGVWZWN0b3IoMzAwLCAzMDApLFxuICAgIGNyZWF0ZVZlY3RvcigzNTAsIDMwMCksXG4gICAgeyBwb3M6IG1vdXNlUG9zQXNWZWN0b3IgfSxcbiAgICAxLFxuICAgIDBcbiAgKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICBnVGVudGFjbGVzLmZvckVhY2godCA9PiB0LnVwZGF0ZSgpKTtcbiAgdGVzdFNlZ21lbnQudXBkYXRlKCk7XG59XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogRFJBV1xuICovXG5mdW5jdGlvbiBkcmF3KCkge1xuICB1cGRhdGUoKTtcbiAgYmFja2dyb3VuZCgwKTtcbiAgZmlsbChcImJsYWNrXCIpO1xuICBub1N0cm9rZSgpO1xuICBnVGVudGFjbGVzLmZvckVhY2godCA9PiB0LmRyYXcoKSk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZU1vdmluZ1N0cnVjdHVyZXMoKSB7XG4gIGFwcE9wdGlvbnMuaXNNb3ZpbmdTdHJ1Y3R1cmVzID0gIWFwcE9wdGlvbnMuaXNNb3ZpbmdTdHJ1Y3R1cmVzO1xufVxuXG5mdW5jdGlvbiBtb3VzZVByZXNzZWQoKSB7fVxuZnVuY3Rpb24ga2V5UHJlc3NlZCgpIHtcbiAgaWYgKGtleSA9PSBcIiBcIikge1xuICB9XG59XG4iLCJjbGFzcyBQYWxldHRlIHtcbiAgc3RhdGljIGdldENvbG9ycygpIHtcbiAgICByZXR1cm4gW1xuICAgICAgY29sb3IoMjUwLCAxMDUsIDApLFxuICAgICAgY29sb3IoMTA1LCAyMTAsIDIzMSksXG4gICAgICBjb2xvcigxNjcsIDIxOSwgMjE2KSxcbiAgICAgIGNvbG9yKDI0MywgMTM0LCA0OClcbiAgICBdO1xuICB9XG4gIHN0YXRpYyByYW5kb21Db2xvcigpOiBwNS5Db2xvciB7XG4gICAgcmV0dXJuIHJhbmRvbShQYWxldHRlLmdldENvbG9ycygpKTtcbiAgfVxufVxuIiwiY2xhc3MgUGFydGljbGUge1xuICBwb3M6IHA1LlZlY3RvcjtcbiAgaGVhZGluZzogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MgPSBwb3MuY29weSgpO1xuICAgIHRoaXMuaGVhZGluZyA9IDA7XG4gIH1cbiAgZHJhdygpIHtcbiAgICBub1N0cm9rZSgpO1xuICAgIGZpbGwoXCJibGFja1wiKTtcbiAgICByZWN0TW9kZShDRU5URVIpO1xuICAgIHNxdWFyZSh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCAzKTtcbiAgICBmaWxsKDAsIDIwKTtcbiAgfVxuICB1cGRhdGUoKSB7XG4gICAgY29uc3QgbW91c2VNb3ZlbWVudEFuZ2xlID0gYW5nbGVPZkxhc3RNb3VzZU1vdmVtZW50KCk7XG4gICAgaWYgKG1vdXNlTW92ZW1lbnRBbmdsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmhlYWRpbmcgPSBtb3VzZU1vdmVtZW50QW5nbGU7XG4gICAgfVxuICB9XG5cbiAgc2V0UG9zaXRpb24ocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcy54ID0gcG9zLng7XG4gICAgdGhpcy5wb3MueSA9IHBvcy55O1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHJhbmRvbVNjcmVlblBvc2l0aW9uKCkpO1xuICB9XG59XG4iLCJpbnRlcmZhY2UgVGFyZ2V0IHtcbiAgcG9zKCk6IHA1LlZlY3Rvcjtcbn1cbmZ1bmN0aW9uIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgY29sb3JNb2RlKEhTQiwgMTAwKTtcbiAgcmV0dXJuIGNvbG9yKHJhbmRvbSgxMDApLCAxMDAsIDEwMCk7XG59XG5jbGFzcyBTZWdtZW50IGltcGxlbWVudHMgVGFyZ2V0IHtcbiAgZGVsdGFUb1RhcmdldDogcDUuVmVjdG9yO1xuICBhOiBwNS5WZWN0b3I7XG4gIGI6IHA1LlZlY3RvcjtcbiAgaWQ6IHN0cmluZztcbiAgbXlDb2xvcjogcDUuQ29sb3I7XG4gIGVkZ2VDb2xvcjogcDUuQ29sb3I7XG4gIHRoaWNrbmVzczogbnVtYmVyO1xuICBsZW46IG51bWJlcjtcbiAgaXNGaXhlZDogYm9vbGVhbjtcbiAgdGFyZ2V0OiBUYXJnZXQ7XG4gIHRhcmdldENvbG9yOiBwNS5Db2xvcjtcbiAgbXlIdWU6IG51bWJlcjtcbiAgY29uc3RydWN0b3IoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBhOiBwNS5WZWN0b3IsXG4gICAgYjogcDUuVmVjdG9yLFxuICAgIHRhcmdldDogVGFyZ2V0LFxuICAgIHRoaWNrbmVzc1NjYWxlOiBudW1iZXIsXG4gICAgbXlIdWU6IG51bWJlclxuICApIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5hID0gYS5jb3B5KCk7XG4gICAgdGhpcy5iID0gYi5jb3B5KCk7XG4gICAgdGhpcy5pc0ZpeGVkID0gZmFsc2U7XG4gICAgdGhpcy5sZW4gPSBhLmRpc3QoYik7XG4gICAgY29sb3JNb2RlKEhTQiwgMTAwKTtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLm15SHVlID0gbXlIdWU7XG4gICAgY29uc3Qgc2F0ID0gNTA7XG4gICAgY29uc3QgYnJpZ2h0ID0gNTA7XG4gICAgdGhpcy5teUNvbG9yID0gY29sb3IodGhpcy5teUh1ZSwgc2F0LCByYW5kb20oYnJpZ2h0IC0gMTAsIGJyaWdodCArIDEwKSk7XG4gICAgdGhpcy5lZGdlQ29sb3IgPSBjb2xvcih0aGlzLm15SHVlLCBzYXQsIGJyaWdodCAtIDIwKTtcbiAgICB0aGlzLnRoaWNrbmVzcyA9IHRoaWNrbmVzc1NjYWxlICogNTAgKiByYW5kb20oMC45LCAxLjEpO1xuICAgIHRoaXMudGFyZ2V0Q29sb3IgPSByYW5kb21Db2xvcigpO1xuICB9XG4gIHBvcygpOiBwNS5WZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmEuY29weSgpO1xuICB9XG5cbiAgZHJhd1NpbGhvdXR0ZSgpIHtcbiAgICBzdHJva2UodGhpcy5lZGdlQ29sb3IpO1xuICAgIG5vRmlsbCgpO1xuICAgIHN0cm9rZSgxMCk7XG4gICAgc3Ryb2tlV2VpZ2h0KHRoaXMudGhpY2tuZXNzKTtcbiAgICBsaW5lKHRoaXMuYS54LCB0aGlzLmEueSwgdGhpcy5iLngsIHRoaXMuYi55KTtcbiAgfVxuICBkcmF3SW5uZXIoKSB7XG4gICAgLy9zdHJva2VDYXAoU1FVQVJFKTtcbiAgICBzdHJva2UodGhpcy5teUNvbG9yKTtcbiAgICBzdHJva2VXZWlnaHQodGhpcy50aGlja25lc3MgKiAwLjgpO1xuICAgIGxpbmUodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuICB9XG4gIHN0YXRpYyBkcmF3Q3Jvc3NoYWlyQXQocG9zOiBwNS5WZWN0b3IsIGNvbHI6IHA1LkNvbG9yKSB7XG4gICAgc3Ryb2tlV2VpZ2h0KDEuOCk7XG4gICAgc3Ryb2tlKGNvbHIpO1xuICAgIHB1c2goKTtcbiAgICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbiAgICBsaW5lKC04LCAwLCA4LCAwKTtcbiAgICBsaW5lKDAsIC04LCAwLCA4KTtcbiAgICBwb3AoKTtcbiAgfVxuICBtaWRQb2ludCgpOiBwNS5WZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmEuY29weSgpLmxlcnAodGhpcy5iLCAwLjUpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbUF0KFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcG9zQTogcDUuVmVjdG9yLFxuICAgIHRhcmdldDogVGFyZ2V0LFxuICAgIHRoaWNrbmVzc1NjYWxlOiBudW1iZXIsXG4gICAgbGVuOiBudW1iZXIsXG4gICAgbXlIdWU6IG51bWJlclxuICApIHtcbiAgICBjb25zdCBwMSA9IHBvc0EuY29weSgpO1xuICAgIGNvbnN0IHAyID0gcDEuY29weSgpLmFkZChwNS5WZWN0b3IucmFuZG9tMkQoKS5tdWx0KGxlbikpO1xuICAgIHJldHVybiBuZXcgU2VnbWVudChpZCwgcDEsIHAyLCB0YXJnZXQsIHRoaWNrbmVzc1NjYWxlLCBteUh1ZSk7XG4gIH1cbiAgdXBkYXRlKCk6IHZvaWQge1xuICAgIHRoaXMuc2Vla1RhcmdldCh0aGlzLnRhcmdldC5wb3MoKSk7XG4gIH1cblxuICBzZWVrVGFyZ2V0KHRhcmdldFBvczogcDUuVmVjdG9yKTogdm9pZCB7XG4gICAgY29uc3QgZGVsdGFUb1RhcmdldCA9IHRhcmdldFBvcy5jb3B5KCkuc3ViKHRoaXMuYSk7XG4gICAgdGhpcy5kZWx0YVRvVGFyZ2V0ID0gZGVsdGFUb1RhcmdldDtcbiAgICB0aGlzLmEgPSB0YXJnZXRQb3MuY29weSgpLmFkZChcbiAgICAgIGRlbHRhVG9UYXJnZXRcbiAgICAgICAgLmNvcHkoKVxuICAgICAgICAubm9ybWFsaXplKClcbiAgICAgICAgLm11bHQoLXRoaXMubGVuKVxuICAgICk7XG4gICAgdGhpcy5iID0gdGFyZ2V0UG9zLmNvcHkoKTtcbiAgfVxufVxuIiwiY2xhc3MgVGVudGFjbGUge1xuICBzZWdtZW50czogU2VnbWVudFtdO1xuICBwcm92aWRlVGFyZ2V0OiAoKSA9PiBwNS5WZWN0b3I7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbnVtU2VnbWVudHM6IG51bWJlcixcbiAgICBmdWxsTGVuZ3RoOiBudW1iZXIsXG4gICAgYmFzZUh1ZU9mMTAwOiBudW1iZXIsXG4gICAgcHJvdmlkZVRhcmdldDogKCkgPT4gcDUuVmVjdG9yXG4gICkge1xuICAgIGxldCBwcmV2UG9zOiBwNS5WZWN0b3IgPSBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgKiAxLjEpO1xuICAgIGNvbnN0IG15SHVlID0gcmFuZG9tKGJhc2VIdWVPZjEwMCAtIDUsIGJhc2VIdWVPZjEwMCArIDUpO1xuICAgIGNvbnN0IGF2Z1NlZ21lbnRMZW5ndGggPSBmdWxsTGVuZ3RoIC8gbnVtU2VnbWVudHM7XG4gICAgdGhpcy5wcm92aWRlVGFyZ2V0ID0gcHJvdmlkZVRhcmdldDtcbiAgICB0aGlzLnNlZ21lbnRzID0gY29sbGVjdERpc3RyaWJ1dGVkQmV0d2VlbihcbiAgICAgIG51bVNlZ21lbnRzLFxuICAgICAgMCxcbiAgICAgIDAuOSxcbiAgICAgICh0aGlja25lc3MsIGl4KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlZ21lbnQgPSBTZWdtZW50LmNyZWF0ZVJhbmRvbUF0KFxuICAgICAgICAgIFwiU2VnXCIgKyBpeCxcbiAgICAgICAgICBwcmV2UG9zLFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICAgMSAtIHRoaWNrbmVzcyxcbiAgICAgICAgICBhdmdTZWdtZW50TGVuZ3RoLFxuICAgICAgICAgIG15SHVlXG4gICAgICAgICk7XG4gICAgICAgIHByZXZQb3MgPSBzZWdtZW50LmIuY29weSgpO1xuICAgICAgICByZXR1cm4gc2VnbWVudDtcbiAgICAgIH1cbiAgICApO1xuICAgIHRoaXMuc2VnbWVudHNbMF0uaXNGaXhlZCA9IHRydWU7XG5cbiAgICBsZXQgdGhpbm5lclNlZ21lbnQ6IFNlZ21lbnQgPSBudWxsO1xuICAgIHRoaXMuc2VnbWVudHMucmV2ZXJzZSgpLmZvckVhY2goc2VnID0+IHtcbiAgICAgIHNlZy50YXJnZXQgPSB0aGlubmVyU2VnbWVudFxuICAgICAgICA/IHRoaW5uZXJTZWdtZW50XG4gICAgICAgIDogeyBwb3M6IHRoaXMucHJvdmlkZVRhcmdldCB9O1xuICAgICAgdGhpbm5lclNlZ21lbnQgPSBzZWc7XG4gICAgfSk7XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCk7XG4gIH1cbiAgdXBkYXRlKCkge1xuICAgIHRoaXMuc2VnbWVudHMucmV2ZXJzZSgpO1xuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy51cGRhdGUoKTtcbiAgICB9XG4gICAgdGhpcy5zZWdtZW50cy5yZXZlcnNlKCk7XG4gIH1cblxuICBkcmF3KCkge1xuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3U2lsaG91dHRlKCk7XG4gICAgfVxuICAgIGZvciAobGV0IHMgb2YgdGhpcy5zZWdtZW50cykge1xuICAgICAgcy5kcmF3SW5uZXIoKTtcbiAgICB9XG4gIH1cbn1cbiIsImZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiBjZW50ZXJTY3JlZW5Qb3MoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cbmZ1bmN0aW9uIHJvdGF0ZVZlcnRleEFyb3VuZChcbiAgdmVydGV4OiBwNS5WZWN0b3IsXG4gIHJvdE9yaWdpbjogcDUuVmVjdG9yLFxuICBhbmdsZVJhZDogbnVtYmVyXG4pOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gdmVydGV4XG4gICAgLmNvcHkoKVxuICAgIC5zdWIocm90T3JpZ2luKVxuICAgIC5yb3RhdGUoYW5nbGVSYWQpXG4gICAgLmFkZChyb3RPcmlnaW4pO1xufVxuXG4vL1Rha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2Jtb3Jlbi9wNS5jb2xsaWRlMkRcbmZ1bmN0aW9uIGNvbGxpZGVMaW5lTGluZShcbiAgeDE6IG51bWJlcixcbiAgeTE6IG51bWJlcixcbiAgeDI6IG51bWJlcixcbiAgeTI6IG51bWJlcixcbiAgeDM6IG51bWJlcixcbiAgeTM6IG51bWJlcixcbiAgeDQ6IG51bWJlcixcbiAgeTQ6IG51bWJlclxuKSB7XG4gIC8vIGNhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgdG8gaW50ZXJzZWN0aW9uIHBvaW50XG4gIGxldCB1QSA9XG4gICAgKCh4NCAtIHgzKSAqICh5MSAtIHkzKSAtICh5NCAtIHkzKSAqICh4MSAtIHgzKSkgL1xuICAgICgoeTQgLSB5MykgKiAoeDIgLSB4MSkgLSAoeDQgLSB4MykgKiAoeTIgLSB5MSkpO1xuICBsZXQgdUIgPVxuICAgICgoeDIgLSB4MSkgKiAoeTEgLSB5MykgLSAoeTIgLSB5MSkgKiAoeDEgLSB4MykpIC9cbiAgICAoKHk0IC0geTMpICogKHgyIC0geDEpIC0gKHg0IC0geDMpICogKHkyIC0geTEpKTtcblxuICAvLyBpZiB1QSBhbmQgdUIgYXJlIGJldHdlZW4gMC0xLCBsaW5lcyBhcmUgY29sbGlkaW5nXG4gIGlmICh1QSA+PSAwICYmIHVBIDw9IDEgJiYgdUIgPj0gMCAmJiB1QiA8PSAxKSB7XG4gICAgLy8gY2FsYyB0aGUgcG9pbnQgd2hlcmUgdGhlIGxpbmVzIG1lZXRcbiAgICBsZXQgaW50ZXJzZWN0aW9uWCA9IHgxICsgdUEgKiAoeDIgLSB4MSk7XG4gICAgbGV0IGludGVyc2VjdGlvblkgPSB5MSArIHVBICogKHkyIC0geTEpO1xuXG4gICAgcmV0dXJuIGNyZWF0ZVZlY3RvcihpbnRlcnNlY3Rpb25YLCBpbnRlcnNlY3Rpb25ZKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqIEZpbmQgdGhlIG1pbmltdW0gb2YgdGhlIGdpdmVuIGxpc3QgYWZ0ZXIgYXBwbHlpbmcgZm4oKSB0byBlYWNoLlxuICogUmV0dXJuIHRoZSBtaW5pbXVtLCBmaXJzdCBtaW5pbXVtLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zLlxuICovXG5mdW5jdGlvbiBtaW5CeTxUPihsaXN0OiBUW10sIGZuOiAoaXRlbTogVCkgPT4gbnVtYmVyKTogVCB7XG4gIGlmIChsaXN0Lmxlbmd0aCA8IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0ID4gcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG5cbi8qKiBSZXBlYXRlZGx5IGNhbGwgdGhlIGdpdmVuIGZ1bmN0aW9uIGZuLCBudW0gdGltZXMsIHRocm93aW5nIGFueSBvdXRwdXQgYXdheS4gKi9cbmZ1bmN0aW9uIHJlcGVhdChudW06IG51bWJlciwgZm46IChpeDogbnVtYmVyKSA9PiB2b2lkKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICBmbihpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBkaXN0cmlidXRlVXBUbyh0b3RhbDogbnVtYmVyLCBtYXg6IG51bWJlciwgZm46ICh2OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgcmVwZWF0KHRvdGFsLCBpeCA9PiB7XG4gICAgY29uc3QgdmFsID0gKGl4ICogbWF4KSAvIHRvdGFsO1xuICAgIHJldHVybiBmbih2YWwpO1xuICB9KTtcbn1cbi8qKiBcbkNvbGxlY3QgYSBzZXQgb2YgdmFsdWVzIGdlbmVyYXRlZCB3aXRoIGZuIGNhbGxlZCB3aXRoIFxuYSByYW5nZSBvZiBudW1TYW1wbGVzIHNhbXBsZXMgZGlzdHJpYnV0ZWQgZXZlbmx5IGZyb20gbWluIHRvIG1heC5cbiovXG5mdW5jdGlvbiBjb2xsZWN0RGlzdHJpYnV0ZWRCZXR3ZWVuPFQ+KFxuICBudW1TYW1wbGVzOiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlcixcbiAgZm46ICh2OiBudW1iZXIsIGl4PzogbnVtYmVyKSA9PiBUXG4pOiBUW10ge1xuICBjb25zdCByZXN1bHQ6IFRbXSA9IFtdO1xuICBkaXN0cmlidXRlQmV0d2VlbihudW1TYW1wbGVzLCBtaW4sIG1heCwgKHYsIGl4KSA9PiByZXN1bHQucHVzaChmbih2LCBpeCkpKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVCZXR3ZWVuKFxuICBudW1TYW1wbGVzOiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlcixcbiAgZm46ICh2OiBudW1iZXIsIGl4PzogbnVtYmVyKSA9PiB2b2lkXG4pIHtcbiAgcmVwZWF0KG51bVNhbXBsZXMsIGl4ID0+IHtcbiAgICBjb25zdCByYW5nZSA9IG1heCAtIG1pbjtcbiAgICBjb25zdCB2YWwgPSBtaW4gKyAoaXggKiByYW5nZSkgLyBudW1TYW1wbGVzO1xuICAgIHJldHVybiBmbih2YWwsIGl4KTtcbiAgfSk7XG59XG5mdW5jdGlvbiBhdmVyYWdlVmVjdG9ycyh2czogcDUuVmVjdG9yW10pOiBwNS5WZWN0b3Ige1xuICBpZiAodnMubGVuZ3RoIDwgMSkge1xuICAgIHJldHVybiBjcmVhdGVWZWN0b3IoMCwgMCk7XG4gIH1cbiAgcmV0dXJuIHZzLnJlZHVjZSgodjEsIHYyKSA9PiB2MS5jb3B5KCkuYWRkKHYyKSwgdnNbMF0pLmRpdih2cy5sZW5ndGgpO1xufVxuXG4vL1RPRE86IGRvbid0IHBvbGx1dGUgZ2xvYmFsXG5jb25zdCBnTGFzdE1vdXNlTW92ZW1lbnRzOiBwNS5WZWN0b3JbXSA9IFtdO1xuXG4vL1RPRE86IHNtb290aCB0aGlzIG91dCBieSBidWZmZXJpbmcgYSBmZXcgbW92ZW1lbnRzXG4vL01haW50YWluIHRoZSBwcmV2aW91cyBhbmdsZSBpZiB0aGVyZSdzIGJlZW4gbm8gbW92ZW1lbnRcbmZ1bmN0aW9uIGFuZ2xlT2ZMYXN0TW91c2VNb3ZlbWVudCgpOiBudW1iZXIge1xuICBjb25zdCBkZWx0YSA9IGNyZWF0ZVZlY3Rvcihtb3VzZVggLSBwbW91c2VYLCBtb3VzZVkgLSBwbW91c2VZKTtcbiAgaWYgKGRlbHRhLm1hZ1NxKCkgPCAxKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSBlbHNlIHtcbiAgICBnTGFzdE1vdXNlTW92ZW1lbnRzLnVuc2hpZnQoZGVsdGEpO1xuICAgIGdMYXN0TW91c2VNb3ZlbWVudHMuc3BsaWNlKDgpO1xuICAgIGNvbnN0IGF2Z01vdmVtZW50ID0gYXZlcmFnZVZlY3RvcnMoZ0xhc3RNb3VzZU1vdmVtZW50cyk7XG5cbiAgICAvL2F2ZXJhZ2UgbWlnaHQgaGF2ZSBjYW5jZWxsZWQgb3V0IGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBoZWFkaW5nXG4gICAgaWYgKGF2Z01vdmVtZW50Lm1hZygpID4gMCkge1xuICAgICAgcmV0dXJuIGF2Z01vdmVtZW50LmhlYWRpbmcoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tQm9vbGVhbigpOiBib29sZWFuIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPiAwLjU7XG59XG5mdW5jdGlvbiBtb3VzZVBvc0FzVmVjdG9yKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IobW91c2VYLCBtb3VzZVkpO1xufVxuIl19